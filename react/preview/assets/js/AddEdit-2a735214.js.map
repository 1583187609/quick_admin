{"version":3,"file":"AddEdit-2a735214.js","sources":["../../../src/views/system/user/account/_components/AddEdit.tsx"],"sourcesContent":["import { FormField, StandardFormFieldAttrs } from \"@/components/BaseFormItem\";\r\nimport BaseForm from \"@/components/form/BaseForm\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { GetUserInfo, PostMockCommon } from \"@/api-mock\";\r\nimport UploadAvatar from \"@/components/upload/UploadAvatar\";\r\nimport { CommonObj } from \"@/vite-env\";\r\n\r\ninterface Props {\r\n  data?: CommonObj;\r\n  refreshList?: () => void;\r\n}\r\n\r\nfunction getFields({ isAdd = false, formRef }: CommonObj): FormField[] {\r\n  return [\r\n    {\r\n      name: \"avatar\",\r\n      label: \"头像\",\r\n      type: \"Custom\",\r\n      render: (attrs: StandardFormFieldAttrs) => <UploadAvatar name=\"avatar\" {...attrs} formRef={formRef} />,\r\n    },\r\n    !isAdd && {\r\n      name: \"nickname\",\r\n      label: \"昵称\",\r\n      attrs: {},\r\n    },\r\n    {\r\n      name: \"name\",\r\n      label: \"姓名\",\r\n      otherAttrs: {\r\n        valid: \"userName\",\r\n      },\r\n    },\r\n    {\r\n      name: \"type\",\r\n      label: \"类型\",\r\n      type: \"Select\",\r\n      attrs: {\r\n        options: \"RoleType\",\r\n      },\r\n    },\r\n    {\r\n      name: \"gender\",\r\n      label: \"性别\",\r\n      type: \"RadioGroup\",\r\n      attrs: {\r\n        options: \"Gender\",\r\n      },\r\n    },\r\n    {\r\n      name: \"age\",\r\n      label: \"年龄\",\r\n      type: \"InputNumber\",\r\n      attrs: {\r\n        max: 100,\r\n        min: 0,\r\n        maxLength: 3,\r\n      },\r\n      otherAttrs: {\r\n        valid: \"age\",\r\n      },\r\n    },\r\n    {\r\n      name: \"address\",\r\n      label: \"地址\",\r\n      type: \"Cascader\",\r\n      attrs: {\r\n        options: \"Region\",\r\n      },\r\n    },\r\n    {\r\n      name: \"phone\",\r\n      label: \"电话\",\r\n      required: true,\r\n      otherAttrs: {\r\n        valid: \"phone\",\r\n      },\r\n    },\r\n  ];\r\n}\r\n\r\n/**\r\n * 直接传入 data 的处理方式\r\n */\r\n// export default ({ data, refreshList }: Props) => {\r\n//   const formRef = useRef();\r\n//   const initVals = Object.assign({ type: 3, gender: 1, age: 18 }, data);\r\n//   return (\r\n//     <BaseForm\r\n//       ref={formRef}\r\n//       initialValues={initVals}\r\n//       style={{ width: \"450px\" }}\r\n//       fields={getFields({\r\n//         isAdd: !data,\r\n//         formRef,\r\n//       })}\r\n//       fetch={PostMockCommon}\r\n//       fetchSuccess={refreshList}\r\n//     />\r\n//   );\r\n// };\r\n\r\n/**\r\n * 通过 id 请求接口的处理方式\r\n */\r\nexport default ({ data, refreshList }: Props) => {\r\n  const formRef = useRef();\r\n  const [initVals, setInitVals] = useState<CommonObj | null>(data ? null : { type: 3, gender: 1, age: 18 });\r\n  useEffect(() => {\r\n    data && getDetail(data.id);\r\n  }, [data]);\r\n  //获取详情数据\r\n  function getDetail(id: string) {\r\n    GetUserInfo({ id }).then((res: CommonObj) => {\r\n      setInitVals(res);\r\n    });\r\n  }\r\n  return (\r\n    (data ? !!initVals : true) && (\r\n      <BaseForm\r\n        ref={formRef}\r\n        initialValues={initVals}\r\n        style={{ width: \"450px\" }}\r\n        fields={getFields({\r\n          isAdd: !data,\r\n          formRef,\r\n        })}\r\n        fetch={PostMockCommon}\r\n        fetchSuccess={refreshList}\r\n      />\r\n    )\r\n  );\r\n};\r\n"],"names":["getFields","isAdd","formRef","attrs","jsx","UploadAvatar","AddEdit","data","refreshList","useRef","initVals","setInitVals","useState","useEffect","getDetail","id","GetUserInfo","res","BaseForm","PostMockCommon"],"mappings":"wlFAYA,SAASA,EAAU,CAAE,MAAAC,EAAQ,GAAO,QAAAC,GAAmC,CAC9D,MAAA,CACL,CACE,KAAM,SACN,MAAO,KACP,KAAM,SACN,OAASC,GAAkCC,EAAAA,IAACC,GAAa,KAAK,SAAU,GAAGF,EAAO,QAAAD,EAAkB,CACtG,EACA,CAACD,GAAS,CACR,KAAM,WACN,MAAO,KACP,MAAO,CAAC,CACV,EACA,CACE,KAAM,OACN,MAAO,KACP,WAAY,CACV,MAAO,UACT,CACF,EACA,CACE,KAAM,OACN,MAAO,KACP,KAAM,SACN,MAAO,CACL,QAAS,UACX,CACF,EACA,CACE,KAAM,SACN,MAAO,KACP,KAAM,aACN,MAAO,CACL,QAAS,QACX,CACF,EACA,CACE,KAAM,MACN,MAAO,KACP,KAAM,cACN,MAAO,CACL,IAAK,IACL,IAAK,EACL,UAAW,CACb,EACA,WAAY,CACV,MAAO,KACT,CACF,EACA,CACE,KAAM,UACN,MAAO,KACP,KAAM,WACN,MAAO,CACL,QAAS,QACX,CACF,EACA,CACE,KAAM,QACN,MAAO,KACP,SAAU,GACV,WAAY,CACV,MAAO,OACT,CACF,CAAA,CAEJ,CA0BA,MAAAK,GAAe,CAAC,CAAE,KAAAC,EAAM,YAAAC,KAAyB,CAC/C,MAAMN,EAAUO,EAAAA,SACV,CAACC,EAAUC,CAAW,EAAIC,WAA2BL,EAAO,KAAO,CAAE,KAAM,EAAG,OAAQ,EAAG,IAAK,EAAI,CAAA,EACxGM,EAAAA,UAAU,IAAM,CACNN,GAAAO,EAAUP,EAAK,EAAE,CAAA,EACxB,CAACA,CAAI,CAAC,EAET,SAASO,EAAUC,EAAY,CAC7BC,EAAY,CAAE,GAAAD,CAAG,CAAC,EAAE,KAAME,GAAmB,CAC3CN,EAAYM,CAAG,CAAA,CAChB,CACH,CACA,OACGV,EAAO,CAAC,CAACG,EAAW,KACnBN,EAAA,IAACc,EAAA,CACC,IAAKhB,EACL,cAAeQ,EACf,MAAO,CAAE,MAAO,OAAQ,EACxB,OAAQV,EAAU,CAChB,MAAO,CAACO,EACR,QAAAL,CAAA,CACD,EACD,MAAOiB,EACP,aAAcX,CAAA,CAAA,CAItB"}