import{r as o,j as a}from"./react-0fb5d424.js";import pt from"./index-97ef7b47.js";import lt from"./index-f6572fd8.js";import ct from"./index-29605927.js";import{getBtnObj as at}from"./_utils-622a59ec.js";import{l as C}from"./lodash-a5a67b6f.js";import{P as ut,o as ft,p as K,g as dt,s as gt}from"./index-fad10ce8.js";import"./dayjs-e40d92c3.js";import{btnsMap as _t}from"./btns-00e868e8.js";import ht from"./ImportModal-0bfb496c.js";import{getBtnModalTips as Rt}from"./_utils-124ad6d2.js";import{o as St}from"./antd-e92fabd5.js";import"./@babel-25fffde3.js";import"./@ant-design-595a63b1.js";import"./@emotion-c0b5c018.js";import"./rc-util-48ba7f71.js";import"./react-is-e8e5dbb3.js";import"./react-dom-0d6193a3.js";import"./scheduler-765c72db.js";import"./stylis-c78c9806.js";import"./classnames-fe2c27d8.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./index-3c5b8abc.js";import"./index-444c7847.js";import"./_config-ba79d20b.js";import"./_utils-d4fe6639.js";import"./index-f55d10b1.js";import"./index-e817da37.js";import"./react-router-dom-57ec7c88.js";import"./react-router-460b03e0.js";import"./@remix-run-ac850e23.js";import"./react-redux-54c164ec.js";import"./use-sync-external-store-29364900.js";import"./mock-52f1b85d.js";import"./mockjs-9c967a30.js";import"./@reduxjs-c09949f6.js";import"./redux-ea15d17b.js";import"./reselect-8f3bbdd7.js";import"./redux-thunk-f771c803.js";import"./axios-4a70c6fc.js";import"./qs-0173dd19.js";import"./side-channel-5b5a05bd.js";import"./get-intrinsic-45907aec.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-f7d0b240.js";import"./function-bind-61637ca6.js";import"./has-57b382c3.js";import"./call-bind-c38f6426.js";import"./object-inspect-42714f7a.js";import"./vite-plugin-mock-d7a8ead1.js";import"./path-to-regexp-31db6522.js";import"./rc-resize-observer-745b2131.js";import"./rc-motion-eb90ae56.js";import"./rc-picker-6e445fc6.js";import"./@rc-component-ed6c637d.js";import"./rc-tabs-3b6d1d00.js";import"./rc-dropdown-3ade4447.js";import"./rc-menu-83466686.js";import"./rc-overflow-114563da.js";import"./rc-trigger-8e81b561.js";import"./rc-align-3928b621.js";import"./dom-align-ecb06dd6.js";import"./rc-cascader-5bc29b89.js";import"./rc-select-3f77be03.js";import"./rc-virtual-list-27fe0724.js";import"./rc-tree-586f51e7.js";import"./rc-input-number-83428087.js";import"./rc-collapse-62224ade.js";import"./rc-drawer-f0808ac3.js";import"./rc-field-form-10847344.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-640b7801.js";import"./compute-scroll-into-view-50f8bc03.js";import"./rc-image-1fde4eb3.js";import"./rc-dialog-fa40b945.js";import"./rc-notification-3e0c56c9.js";import"./rc-tooltip-f3685bbd.js";import"./rc-rate-49702ee4.js";import"./rc-slider-a4dd6cf2.js";import"./rc-steps-fcee3d43.js";import"./rc-switch-9e1e6b4a.js";import"./rc-table-dcede9bc.js";import"./rc-pagination-88d89b42.js";import"./throttle-debounce-87e7e444.js";import"./rc-checkbox-d7b3fa29.js";import"./rc-input-3e170e62.js";import"./rc-textarea-3d294471.js";import"./rc-upload-215eca2a.js";import"./rc-progress-48fe049f.js";import"./index-b0ce1d27.js";import"./index-ebe47c01.js";import"./SetPrint-0243b550.js";import"./SetTable-b8040002.js";import"./index-7cf152b6.js";import"./index-e60d50fe.js";const Ct={curr_page:"curr_page",page_size:"page_size"},jt={curr_page:"curr_page",page_size:"page_size",total_num:"total_num",records:"records"},L=["delete","export"],xt=["delete","import","export"],yt="_children_1lxg2_15",v={"base-crud":"_base-crud_1lxg2_11",children:yt};let j=[];const ur=o.forwardRef(({className:F="",fields:x=[],columns:J=[],formAttrs:d,tableAttrs:Q,fetch:_,isOmit:T=!0,immediateFetch:B=!0,changeFetch:H=!0,extraBtns:U=[],operateBtns:D=[],onExtraBtn:l,onOperateBtn:G,extraParams:y,exportMax:W=2e4,sort:X,index:Y,selection:b,reqMap:m={},resMap:h={},log:w=!0,children:z,filterByAuth:N=g=>{var u;return g.includes((u=dt())==null?void 0:u.type)}},Z)=>{const g=o.useRef(null),u=o.useRef(null),R=o.useRef(0),n=o.useRef({}),{openPopup:M,closePopup:S}=o.useContext(ut),[p,$]=o.useState([]),[E,O]=o.useState(!1),[q,A]=o.useState([]);Object.assign(m,Ct),Object.assign(h,jt);const P={[`${m.curr_page}`]:1,[`${m.page_size}`]:20};j=J.filter(t=>!!t);const[k,tt]=o.useState(j),et=U.map(t=>{const e=at(t);return L.includes(e.name)&&(e.popconfirm=!1),xt.includes(e.name)&&(e.attrs.disabled=!p.length),e});o.useImperativeHandle(Z,()=>({formRef:g,tableRef:u,refresh(t){c(void 0,t)}}),[]),o.useEffect(()=>{B&&I()},[]);function I(){n.current=C.merge({},d==null?void 0:d.initialValues,P,y),c()}function c(t=n.current,e){O(!0),T&&(t=ft(t)),w&&K(t,"req"),_==null||_(t).then(r=>{const i=r[h.records];w&&K(JSON.parse(JSON.stringify(i)),"res"),A(i),R.current=r[h.total_num],e==null||e()}).finally(()=>{O(!1)})}function rt(t){if(t==="import")return M({title:"温馨提示",footer:null},a.jsx(ht,{}),"modal");const e={params:n.current,ids:p,fields:[]},r=(i=`${_t[t].text}成功！`,f,s,mt=!0)=>{gt(i),S==null||S(f),mt&&c(n.current),s==null||s()};if(!L.includes(t))return l==null?void 0:l(t,e,r);St.confirm({title:"温馨提示",content:Rt(t,p.length,W),onOk:()=>l==null?void 0:l(t,e,r)})}function ot(t,e){for(let r in t)t[r]===void 0&&(t[r]="");if(C.merge(n.current,t,P),H){const[r]=Object.entries(changedVals)[0],i=x.find(s=>s?s.name===r:!1);if(!i)return;const{type:f}=i;["Select"].includes(f)&&c()}}function it(t,e){c(t,e)}function st(t,e){C.merge(n.current,{[`${m.curr_page}`]:t,[`${m.page_size}`]:e}),c()}function nt(t,e){if(t.length)return $(p.concat(t));const r=n.current[m.curr_page],i=n.current[m.page_size],f=(r-1)*20,s=p.slice();s.splice(f,i),$(s)}function V(t){return N?t.filter(({auth:e})=>e!=null&&e.length?N(e):!0):t}return a.jsxs("div",{className:`${F} ${v["base-crud"]} auto-scroll-table f-1 f-fs-s-c`,children:[a.jsx(pt,{className:"f-0",fields:x,extraParams:y,onValuesChange:ot,onSubmit:it,onReset:I,...d,ref:g}),!!z&&a.jsx("div",{className:`${v.children} f-0 mt-16`,children:z}),a.jsx(ct,{className:"f-0 mt-o",onClick:t=>rt(t),allColumns:j,columns:k,setColumns:tt,btns:V(et),seledNum:p.length,total:R.current,batchBtn:!!b}),a.jsx(lt,{ref:u,columns:k,dataSource:q,total:R.current,sort:X,index:Y,selection:b,operateBtns:D,filterBtnsByAuth:V,onOperateBtn:G,onPageChange:st,selectedRowKeys:p,onSelectionChange:nt,loading:E,...Q})]})});export{ur as default};
