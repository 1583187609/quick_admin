{"version":3,"file":"index-1eb410eb.js","sources":["../../../src/views/login/index.vue"],"sourcesContent":["<!-- 登录页面 -->\r\n<!-- <route lang=\"yaml\">\r\nname: login\r\nmeta:\r\n  title: 登录\r\n  constant: true\r\n  layout: false\r\n</route> -->\r\n\r\n<template>\r\n  <div class=\"wrap f-c-c\">\r\n    <div class=\"bounce-in login-box\">\r\n      <h1 class=\"head f-c-c\">{{ VITE_APP_NAME }}</h1>\r\n      <BaseForm\r\n        class=\"body\"\r\n        v-model=\"model\"\r\n        size=\"large\"\r\n        :loading=\"loading\"\r\n        :fields=\"fields\"\r\n        @submit=\"handleSubmit\"\r\n        submitText=\"登录\"\r\n        ref=\"formRef\"\r\n      >\r\n        <!-- :fetch=\"PostUserLogin\" -->\r\n        <template #captcha>\r\n          <Captcha v-model=\"model.captcha\" prop=\"captcha\" />\r\n        </template>\r\n      </BaseForm>\r\n      <div class=\"foot f-sb-c\">\r\n        <el-button\r\n          @click=\"openPopup({ title: '免费注册', direction: 'ltr' }, Register, 'drawer')\"\r\n          class=\"btn\"\r\n          type=\"info\"\r\n          size=\"small\"\r\n          link\r\n        >\r\n          免费注册\r\n        </el-button>\r\n        <el-button @click=\"openPopup('找回密码', FindPassword, 'drawer')\" class=\"btn\" type=\"info\" size=\"small\" link>\r\n          找回密码\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, inject, computed } from \"vue\";\r\nimport { GetUserLoginAccounts } from \"@/api-mock\";\r\nimport { FormFieldAttrs } from \"@/components/BaseFormItem\";\r\nimport FindPassword from \"./FindPassword.vue\";\r\nimport Register from \"./Register.vue\";\r\nimport Captcha from \"./_components/Captcha.vue\";\r\nimport { CommonObj, FinallyNext, StrNum } from \"@/vite-env\";\r\nimport { storage } from \"@/utils\";\r\nimport { useUserStore } from \"@/store\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"Login\" }); \n\r\n\r\nconst { VITE_APP_NAME } = import.meta.env;\r\nconst openPopup: any = inject(\"openPopup\");\r\nconst userStore = useUserStore();\r\nconst loading = ref(false);\r\nconst accountOpts = ref<CommonObj[]>([]);\r\nconst storeAccount = storage.getItem(\"rememberAccount\");\r\nconst model = reactive<CommonObj>({\r\n  phone: storeAccount?.phone ?? \"18483221518\",\r\n  psd: storeAccount?.psd ?? \"superAdmin12345\",\r\n  captcha: \"\",\r\n  remember: !!storeAccount,\r\n});\r\nconst fields = computed<FormFieldAttrs[]>(() => {\r\n  return [\r\n    {\r\n      prop: \"phone\",\r\n      label: \"账号\",\r\n      required: true,\r\n      type: \"autocomplete\",\r\n      attrs: {\r\n        placeholder: \"请输入账号 / 手机号\",\r\n        autocomplete: \"off\",\r\n        onSelect: handleSelect,\r\n        fetchSuggestions: handleFetchSuggestions,\r\n      },\r\n      extra: {\r\n        valid: /^\\d/.test(model.phone) ? \"phone\" : undefined,\r\n      },\r\n    },\r\n    {\r\n      prop: \"psd\",\r\n      label: \"密码\",\r\n      required: true,\r\n      attrs: {\r\n        type: \"password\",\r\n        autocomplete: \"off\",\r\n      },\r\n      extra: {\r\n        valid: \"password\",\r\n      },\r\n    },\r\n    {\r\n      prop: \"captcha\",\r\n      label: \"验证码\",\r\n      type: \"custom\",\r\n      required: true,\r\n    },\r\n    {\r\n      prop: \"remember\",\r\n      label: \"记住我\",\r\n      type: \"checkbox\",\r\n      // size: \"small\",\r\n    },\r\n  ];\r\n});\r\nloadAll();\r\nfunction loadAll() {\r\n  GetUserLoginAccounts().then((res: CommonObj[]) => {\r\n    accountOpts.value = res.map((item: CommonObj) => {\r\n      const { account, ...rest } = item;\r\n      return { value: account, ...rest };\r\n    });\r\n  });\r\n}\r\nfunction handleSubmit(data: CommonObj) {\r\n  loading.value = true;\r\n  userStore.handleLoginIn(data).finally(() => {\r\n    loading.value = false;\r\n  });\r\n}\r\nfunction handleFetchSuggestions(queryStr: string, cb: any) {\r\n  let opts = accountOpts.value;\r\n  if (queryStr) {\r\n    opts = accountOpts.value.filter((queryStr: string) => {\r\n      return (item: CommonObj) => item.value.toLowerCase().indexOf(queryStr.toLowerCase()) === 0;\r\n    });\r\n  }\r\n  cb(opts);\r\n}\r\nfunction handleSelect(item: CommonObj) {\r\n  model.psd = item.psd;\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.wrap {\r\n  height: 100vh;\r\n  width: 100vw;\r\n  background: url(\"@/assets/images/bg/login.jpg\") no-repeat 0 0/100% 100% #eee;\r\n}\r\n.bounce-in {\r\n  animation: bounceIn 1.2s;\r\n}\r\n.login-box {\r\n  width: 500px;\r\n  border-radius: 20px;\r\n  overflow: hidden;\r\n  box-shadow: $shadow-heavy;\r\n  background: #fff;\r\n  .head {\r\n    color: $color-primary;\r\n    font-weight: 600;\r\n    font-size: 30px;\r\n    height: 100px;\r\n    background: #eee;\r\n  }\r\n  .body {\r\n    padding: $gap-two 50px 0;\r\n  }\r\n  .foot {\r\n    padding: $gap 50px $gap-two;\r\n  }\r\n}\r\n@keyframes bounceIn {\r\n  0% {\r\n    opacity: 0;\r\n    transform: scale(0.3);\r\n  }\r\n  50% {\r\n    opacity: 1;\r\n    transform: scale(1.05);\r\n  }\r\n  70% {\r\n    transform: scale(0.9);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n</style>\r\n"],"names":["VITE_APP_NAME","openPopup","inject","userStore","useUserStore","loading","ref","accountOpts","storeAccount","storage","getItem","model","reactive","phone","psd","captcha","remember","fields","computed","prop","label","required","type","attrs","placeholder","autocomplete","onSelect","handleSelect","fetchSuggestions","handleFetchSuggestions","extra","valid","test","handleSubmit","data","value","handleLoginIn","finally","queryStr","cb","opts","filter","item","toLowerCase","indexOf","GetUserLoginAccounts","then","res","map","account","rest"],"mappings":"oxDA2DM,MAAAA,cAAEA,GAAkB,8HACpBC,EAAiBC,EAAO,aACxBC,EAAYC,IACZC,EAAUC,GAAI,GACdC,EAAcD,EAAiB,IAC/BE,EAAeC,EAAQC,QAAQ,mBAC/BC,EAAQC,EAAoB,CAChCC,aAAOL,WAAcK,QAAS,cAC9BC,WAAKN,WAAcM,MAAO,kBAC1BC,QAAS,GACTC,WAAYR,IAERS,EAASC,GAA2B,IACjC,CACL,CACEC,KAAM,QACNC,MAAO,KACPC,UAAU,EACVC,KAAM,eACNC,MAAO,CACLC,YAAa,cACbC,aAAc,MACdC,SAAUC,EACVC,iBAAkBC,GAEpBC,MAAO,CACLC,MAAO,MAAMC,KAAKrB,EAAME,OAAS,aAAU,IAG/C,CACEM,KAAM,MACNC,MAAO,KACPC,UAAU,EACVE,MAAO,CACLD,KAAM,WACNG,aAAc,OAEhBK,MAAO,CACLC,MAAO,aAGX,CACEZ,KAAM,UACNC,MAAO,MACPE,KAAM,SACND,UAAU,GAEZ,CACEF,KAAM,WACNC,MAAO,MACPE,KAAM,eAcZ,SAASW,EAAaC,GACpB7B,EAAQ8B,OAAQ,EAChBhC,EAAUiC,cAAcF,GAAMG,SAAQ,KACpChC,EAAQ8B,OAAQ,CAAA,GAEpB,CACS,SAAAN,EAAuBS,EAAkBC,GAChD,IAAIC,EAAOjC,EAAY4B,MACnBG,IACFE,EAAOjC,EAAY4B,MAAMM,QAAQH,GACvBI,GAAiF,IAA7DA,EAAKP,MAAMQ,cAAcC,QAAQN,EAASK,kBAG1EJ,EAAGC,EACL,CACA,SAASb,EAAae,GACpB/B,EAAMG,IAAM4B,EAAK5B,GACnB,QAxBuB+B,IAAEC,MAAMC,IAC3BxC,EAAY4B,MAAQY,EAAIC,KAAKN,IAC3B,MAAMO,QAAEA,KAAYC,GAASR,EAC7B,MAAO,CAAEP,MAAOc,KAAYC,EAAK,GAClC"}