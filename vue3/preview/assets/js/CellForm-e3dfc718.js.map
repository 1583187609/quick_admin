{"version":3,"file":"CellForm-e3dfc718.js","sources":["../../../src/components/form/CellForm.vue"],"sourcesContent":["<!-- 单元格表单 -->\r\n<template>\r\n  <el-form class=\"cell-form f-fs-s-c f-1\" :model=\"formData\" v-bind=\"defaultFormAttrs\" ref=\"formRef\">\r\n    <div class=\"box all-hide-scroll\" :class=\"[fields.length ? 'f-fs-s-w' : 'f-c-c', autoFixedFoot && 'auto-fixed-foot']\">\r\n      <template v-if=\"fields.length\">\r\n        <el-col\r\n          v-bind=\"field.colAttrs || Object.assign({}, defaultColSpanAttrs, colSpanAttrs)\"\r\n          v-for=\"(field, ind) in fields\"\r\n          :key=\"ind\"\r\n        >\r\n          <BaseFormItem\r\n            :field=\"field\"\r\n            :pureText=\"field.extra?.pureText || pureText\"\r\n            v-model=\"formData[field.prop as string]\"\r\n            @change=\"(prop:any,val:any)=>emits('change',prop,val)\"\r\n            :formRef=\"formRef\"\r\n          >\r\n            <template #custom=\"{ field: currField }\">\r\n              <slot :name=\"currField.prop\" :field=\"currField\" :form=\"formData\"></slot>\r\n            </template>\r\n          </BaseFormItem>\r\n        </el-col>\r\n      </template>\r\n      <template v-else>空空如也~</template>\r\n    </div>\r\n    <FooterBtns\r\n      :loading=\"loading\"\r\n      :moreBtns=\"moreBtns\"\r\n      :submitText=\"submitText\"\r\n      :resetText=\"resetText\"\r\n      :formRef=\"formRef\"\r\n      :isOmit=\"isOmit\"\r\n      :log=\"log\"\r\n      :debug=\"debug\"\r\n      :params=\"merge({}, formData, extraParams)\"\r\n      :fetch=\"fetch\"\r\n      :fetchSuccess=\"fetchSuccess\"\r\n      :fetchFail=\"fetchFail\"\r\n      :noSubmitProps=\"noSubmitProps\"\r\n      :handleRequest=\"handleRequest\"\r\n      :disabled=\"!newFields.length\"\r\n      @moreBtns=\"(name:string, args?:CommonObj, cb?:FinallyNext) => emits('moreBtns', name, args, cb)\"\r\n      @submit=\"(args:CommonObj)=>emits('submit', args)\"\r\n      ref=\"footerBtnsRef\"\r\n      v-if=\"!pureText && footer\"\r\n    />\r\n  </el-form>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nexport default {\r\n  inheritAttrs: false,\r\n};\r\n</script>\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, computed, watch } from \"vue\";\r\nimport { FormInstance } from \"element-plus\";\r\nimport { FormFieldAttrs } from \"@/components/BaseFormItem\";\r\nimport { merge } from \"lodash\";\r\nimport { handleFields } from \"./_utils\";\r\nimport FooterBtns from \"./_components/FooterBtns.vue\";\r\nimport { isProd } from \"@/components/_utils\";\r\nimport { ColSpanAttrs } from \"../table/CellTable.vue\";\r\nimport { BaseBtnType } from \"@/components/BaseBtn\";\r\nimport { defaultFormAttrs } from \"@/components/form\";\r\nimport { CommonObj, FinallyNext, FetchType } from \"@/vite-env\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"CellForm\" }); \n\r\nexport interface CellFormField extends FormFieldAttrs {\r\n  colAttrs?: ColSpanAttrs;\r\n}\r\nconst defaultColSpanAttrs: ColSpanAttrs = {\r\n  // xs: 24, // <768\r\n  // sm: 12, // >=768\r\n  // md: 8, // >=992\r\n  // lg: 6, // >=1200\r\n  // xl: 4, // >=1920\r\n  span: 6,\r\n};\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    modelValue?: CommonObj; //表单数据\r\n    fields: CellFormField[]; //表单字段项\r\n    pureText?: boolean; //是否纯文本展示\r\n    fetch?: FetchType | ((params: CommonObj) => FetchType);\r\n    fetchSuccess?: FinallyNext; //fetch请求成功之后的回调方法\r\n    fetchFail?: () => void; //fetch请求失败之后的回调方法\r\n    footer?: boolean; //是否显示底部按钮\r\n    submitText?: string; //提交按钮的文字\r\n    resetText?: string; //提交按钮的文字\r\n    extraParams?: CommonObj; //额外的参数\r\n    moreBtns?: BaseBtnType[]; //底部的额外更多按钮\r\n    colSpanAttrs?: ColSpanAttrs;\r\n    loading?: boolean; //提交按钮是否显示加载图标\r\n    isOmit?: boolean; //是否剔除掉 undefined，'' 参数\r\n    log?: boolean; //是否通过 console.log 打印输出请求参数和响应参数\r\n    debug?: boolean; //是否终止提交，并打印传参\r\n    autoFixedFoot?: boolean; //是否自动固定底部下方按钮（设为false时，盒子阴影才不会被遮挡）\r\n    noSubmitProps?: string[]; //提交表单时，不要提交的prop属性\r\n    handleRequest?: (args: CommonObj) => CommonObj; //处理参数\r\n  }>(),\r\n  {\r\n    modelValue: () => reactive({}),\r\n    log: !isProd,\r\n    footer: true,\r\n    isOmit: true,\r\n    autoFixedFoot: true,\r\n    fields: () => [],\r\n  }\r\n);\r\nconst emits = defineEmits([\"update:modelValue\", \"submit\", \"change\", \"moreBtns\"]);\r\nconst formRef = ref<FormInstance>();\r\nconst footerBtnsRef = ref<any>(null);\r\nconst newFields = ref<FormFieldAttrs[]>([]);\r\nconst formData = computed({\r\n  get() {\r\n    return props.modelValue;\r\n  },\r\n  set(val: CommonObj) {\r\n    emits(\"update:modelValue\", val);\r\n  },\r\n});\r\nwatch(\r\n  () => props.fields,\r\n  newVal => {\r\n    const { modelValue } = props;\r\n    const result = handleFields(newVal, emits, modelValue);\r\n    const { data, fields } = result;\r\n    newFields.value = fields;\r\n    merge(formData.value, data);\r\n  },\r\n  { immediate: true, deep: true }\r\n);\r\ndefineExpose({\r\n  formRef,\r\n});\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.cell-form {\r\n  height: 100%;\r\n  outline: $color-border-main solid 1px;\r\n}\r\n.auto-fixed-foot {\r\n  overflow: auto;\r\n  overscroll-behavior: auto;\r\n}\r\n.base-form-item {\r\n  padding: 2px;\r\n  margin-bottom: 0;\r\n  outline: $color-border-main solid 1px;\r\n  overflow: hidden;\r\n  // flex: 1;\r\n  // flex-basis: 250px;\r\n}\r\n</style>\r\n"],"names":["inheritAttrs","defaultColSpanAttrs","span","props","__props","emits","__emit","formRef","ref","footerBtnsRef","newFields","formData","computed","get","modelValue","set","val","watch","fields","newVal","result","handleFields","data","value","merge","immediate","deep","__expose"],"mappings":"onDAkDA,aACEA,cAAc,ihBAqBhB,MAAMC,EAAoC,CAMxCC,KAAM,GAEFC,EAAQC,EA+BRC,EAAQC,EACRC,EAAUC,IACVC,EAAgBD,EAAS,MACzBE,EAAYF,EAAsB,IAClCG,EAAWC,EAAS,CACxBC,IAAM,IACGV,EAAMW,WAEf,GAAAC,CAAIC,GACFX,EAAM,oBAAqBW,EAC7B,WAEFC,GACE,IAAMd,EAAMe,SACFC,IACF,MAAAL,WAAEA,GAAeX,EACjBiB,EAASC,EAAaF,EAAQd,EAAOS,IACrCQ,KAAEA,EAAMJ,OAAAA,GAAWE,EACzBV,EAAUa,MAAQL,EACZM,EAAAA,MAAAb,EAASY,MAAOD,EAAI,GAE5B,CAAEG,WAAW,EAAMC,MAAM,IAEdC,EAAA,CACXpB"}