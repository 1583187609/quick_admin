{"version":3,"file":"BaseForm-27fc69f1.js","sources":["../../../src/components/form/BaseForm.vue"],"sourcesContent":["<!-- 基础表单 -->\r\n<template>\r\n  <el-form class=\"base-form f-fs-s-c f-1\" :model=\"formData\" v-bind=\"defaultFormAttrs\" @keyup.enter=\"handleEnter\" ref=\"formRef\">\r\n    <div class=\"all-hide-scroll\" :class=\"[newFields.length ? 'f-fs-fs-w' : 'f-c-c', autoFixedFoot && 'auto-fixed-foot']\">\r\n      <template v-if=\"newFields.length\">\r\n        <!-- @change=\"(prop:any,val:any)=>emits('change',prop,val)\" -->\r\n        <BaseFormItem\r\n          :className=\"`f-span-${field.extra?.span || span}`\"\r\n          :field=\"field\"\r\n          :pureText=\"field.extra?.pureText || pureText\"\r\n          v-model=\"formData[field.prop as string]\"\r\n          @change=\"(prop:any,val:any)=>emits('change',prop,val)\"\r\n          :formRef=\"formRef\"\r\n          v-for=\"(field, ind) in newFields\"\r\n          :key=\"field.key ?? ind\"\r\n        >\r\n          <template #custom=\"{ field: currField }\">\r\n            <slot :name=\"currField.prop\" :field=\"currField\" :form=\"formData\"></slot>\r\n          </template>\r\n        </BaseFormItem>\r\n      </template>\r\n      <template v-else>空空如也~</template>\r\n    </div>\r\n    <FooterBtns\r\n      :loading=\"loading\"\r\n      :moreBtns=\"moreBtns\"\r\n      :submitText=\"submitText\"\r\n      :resetText=\"resetText\"\r\n      :formRef=\"formRef\"\r\n      :isOmit=\"isOmit\"\r\n      :log=\"log\"\r\n      :debug=\"debug\"\r\n      :params=\"params\"\r\n      :fetch=\"fetch\"\r\n      :fetchSuccess=\"fetchSuccess\"\r\n      :fetchFail=\"fetchFail\"\r\n      :noSubmitProps=\"noSubmitProps\"\r\n      :handleRequest=\"handleRequest\"\r\n      :disabled=\"!newFields.length\"\r\n      @moreBtns=\"(name:string, args?:CommonObj, cb?:FinallyNext) => emits('moreBtns', name, args, cb)\"\r\n      @submit=\"(args:CommonObj)=>emits('submit', args)\"\r\n      ref=\"footerBtnsRef\"\r\n      v-if=\"!pureText && footer\"\r\n    />\r\n  </el-form>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, computed, watch } from \"vue\";\r\nimport { FormInstance } from \"element-plus\";\r\nimport { handleFields } from \"./_utils\";\r\nimport { FormField, FormFieldAttrs } from \"@/components/BaseFormItem\";\r\nimport { merge } from \"lodash\";\r\nimport FooterBtns from \"./_components/FooterBtns.vue\";\r\nimport { isProd } from \"@/components/_utils\";\r\nimport { BaseBtnType } from \"@/components/BaseBtn\";\r\nimport { defaultFormAttrs } from \"@/components/form\";\r\nimport { CommonObj, FinallyNext, UniteFetchType } from \"@/vite-env\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"BaseForm\" }); \n\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    modelValue?: CommonObj; //表单数据\r\n    fields: FormField[]; //表单字段项\r\n    pureText?: boolean; //是否纯文本展示\r\n    fetch?: UniteFetchType; //请求接口，一般跟fetchSuccess，fetchFail一起配合使用\r\n    fetchSuccess?: FinallyNext; //fetch请求成功之后的回调方法\r\n    fetchFail?: FinallyNext; //fetch请求失败之后的回调方法\r\n    span?: string | number; //同ElementPlus 的span，1 ~ 24\r\n    footer?: boolean; //是否显示底部按钮\r\n    submitText?: string; //提交按钮的文字\r\n    resetText?: string; //提交按钮的文字\r\n    extraParams?: CommonObj; //额外的参数\r\n    moreBtns?: BaseBtnType[]; //底部的额外更多按钮\r\n    loading?: boolean; //提交按钮是否显示加载图标\r\n    isOmit?: boolean; //是否剔除掉 undefined，'' 参数\r\n    log?: boolean; //是否通过 console.log 打印输出请求参数和响应参数\r\n    debug?: boolean; //是否终止提交，并打印传参\r\n    isCache?: boolean; //是否缓存\r\n    autoFixedFoot?: boolean; //是否自动固定底部下方按钮（设为false时，盒子阴影才不会被遮挡）\r\n    noSubmitProps?: string[]; //提交表单时，不要提交的prop属性\r\n    handleRequest?: (args: CommonObj) => CommonObj; //处理参数\r\n  }>(),\r\n  {\r\n    modelValue: () => reactive({}),\r\n    log: !isProd,\r\n    span: 24,\r\n    footer: true,\r\n    isOmit: true,\r\n    autoFixedFoot: true,\r\n    fields: () => [],\r\n  }\r\n);\r\nconst emits = defineEmits([\"update:modelValue\", \"submit\", \"change\", \"moreBtns\"]);\r\nconst footerBtnsRef = ref<any>(null);\r\nconst formRef = ref<FormInstance>();\r\nconst newFields = ref<FormFieldAttrs[]>([]);\r\nconst formData = computed({\r\n  get() {\r\n    return props.modelValue;\r\n  },\r\n  set(val: CommonObj) {\r\n    emits(\"update:modelValue\", val);\r\n  },\r\n});\r\nconst params = computed(() => merge({}, formData.value, props.extraParams));\r\nwatch(\r\n  () => props.fields,\r\n  newVal => {\r\n    const { modelValue } = props;\r\n    const result = handleFields(newVal, emits, modelValue);\r\n    const { data, fields } = result;\r\n    newFields.value = fields;\r\n    merge(formData.value, data);\r\n  },\r\n  { immediate: true, deep: true }\r\n);\r\n//处理表单的enter时间\r\nfunction handleEnter() {\r\n  if (props.fetch) {\r\n    footerBtnsRef.value.submit();\r\n  } else {\r\n    emits(\"submit\", params.value);\r\n  }\r\n}\r\ndefineExpose({\r\n  formRef,\r\n  formValidate() {\r\n    return footerBtnsRef.value.formValidate();\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.base-form {\r\n  height: 100%;\r\n}\r\n.auto-fixed-foot {\r\n  overflow: auto;\r\n  overscroll-behavior: auto;\r\n}\r\n</style>\r\n"],"names":["props","__props","emits","__emit","footerBtnsRef","ref","formRef","newFields","formData","computed","get","modelValue","set","val","params","merge","value","extraParams","handleEnter","fetch","submit","watch","fields","newVal","result","handleFields","data","immediate","deep","__expose","formValidate"],"mappings":"qqEA6DA,MAAMA,EAAQC,EAiCRC,EAAQC,EACRC,EAAgBC,EAAS,MACzBC,EAAUD,IACVE,EAAYF,EAAsB,IAClCG,EAAWC,EAAS,CACxBC,IAAM,IACGV,EAAMW,WAEf,GAAAC,CAAIC,GACFX,EAAM,oBAAqBW,EAC7B,IAEIC,EAASL,GAAS,IAAMM,QAAM,CAAA,EAAIP,EAASQ,MAAOhB,EAAMiB,eAa9D,SAASC,IACHlB,EAAMmB,MACRf,EAAcY,MAAMI,SAEdlB,EAAA,SAAUY,EAAOE,MAE3B,QAlBAK,GACE,IAAMrB,EAAMsB,SACFC,IACF,MAAAZ,WAAEA,GAAeX,EACjBwB,EAASC,EAAaF,EAAQrB,EAAOS,IACrCe,KAAEA,EAAMJ,OAAAA,GAAWE,EACzBjB,EAAUS,MAAQM,EACZP,EAAAA,MAAAP,EAASQ,MAAOU,EAAI,GAE5B,CAAEC,WAAW,EAAMC,MAAM,IAUdC,EAAA,CACXvB,UACAwB,aAAe,IACN1B,EAAcY,MAAMc"}