{"version":3,"file":"_utils-3b6e9f49.js","sources":["../../../src/components/BaseCrud/_config.ts","../../../src/components/BaseCrud/_utils.ts"],"sourcesContent":["import { BtnName, BtnItem } from \"@/components/BaseBtn\";\r\n\r\n/**\r\n * 可以进行批量操作的按钮；\r\n * 有dialog提示又有popconfirm提示，且不需要popconfirm提示的按钮\r\n */\r\nexport const batchBtnNames: BtnName[] = [\"delete\", \"export\", \"pass\", \"reject\", \"repeal\", \"enable\", \"forbid\", \"download\"];\r\n\r\n// 能够自定义逻辑规则的按钮\r\nexport const customableRuleBtns: BtnName[] = [\"export\"];\r\n","import { ElMessageBox } from \"element-plus\";\r\nimport { upperFirst } from \"lodash\";\r\nimport { BtnName, BtnItem } from \"@/components/BaseBtn\";\r\nimport { CommonObj, StrNum } from \"@/vite-env\";\r\nimport cssVars from \"@/assets/styles/_var.module.scss\";\r\nimport {\r\n  rangeJoinChar,\r\n  typeOf,\r\n  getLabelFromOptionsByAllValues,\r\n  getLabelFromOptionsByLastValue,\r\n  defaultFormItemType,\r\n  showMessage,\r\n} from \"@/components/_utils\";\r\nimport { TableField, TableColAttrs } from \"@/components/table\";\r\nimport { FormFieldAttrs } from \"@/components/BaseFormItem\";\r\nimport { HandleClickExtraBtnsProps, SpecialBoolColType } from \"./_types\";\r\nimport { batchBtnNames } from \".\";\r\nimport { BaseBtnType, getBtnObj } from \"@/components/BaseBtn\";\r\nimport ImportPopup from \"./_components/ImportPopup.vue\";\r\nimport { h } from \"vue\";\r\n\r\nexport interface ExtraBtnRestArgs {\r\n  selectedKeys: string[];\r\n  selectedRows: CommonObj[];\r\n  exportRows: string[][];\r\n}\r\n\r\n// \"index\", \"selection\", \"sort\", \"operate\", \"id\", \"create\", \"update\", \"remark\", \"custom\", \"switch\", \"BaseTag\", \"BaseImg\", \"BaseText\", \"BaseCopy\", \"UserInfo\"\r\nconst allowList = [undefined, \"index\", \"id\", \"create\", \"update\", \"remark\"];\r\nexport function handleClickExtraBtns({\r\n  btnObj,\r\n  cols,\r\n  seledRows,\r\n  seledKeys,\r\n  total,\r\n  exportCfg,\r\n  emits,\r\n  next,\r\n  openPopup,\r\n  importCfg,\r\n}: HandleClickExtraBtnsProps) {\r\n  const { name = \"\", text, attrs, customRules } = btnObj;\r\n  if (customRules)\r\n    return emits(\"extraBtn\", name, next, {\r\n      selectedKeys: [],\r\n      selectedRows: [],\r\n      exportRows: [],\r\n    });\r\n  const colorType = attrs?.type || \"primary\";\r\n  const colorKey = `color${upperFirst(colorType)}`;\r\n  const color = cssVars[colorKey];\r\n  if (batchBtnNames.includes(name)) {\r\n    const isSeledAll = seledRows.length === total; //是否选择了所有\r\n    const isOverLimit = seledRows.length > exportCfg!.limit;\r\n    if (([\"export\"] as BtnName[]).includes(name) && isOverLimit) {\r\n      showMessage(\r\n        {\r\n          message: `单次${text}不能超过 <b>${exportCfg!.limit}</b> 条，请缩小查询范围！`,\r\n          dangerouslyUseHTMLString: true,\r\n        },\r\n        \"warning\"\r\n      );\r\n    } else {\r\n      const hintTips = `确定 <b style=\"color:${color};\">${text}${\r\n        isSeledAll ? `全部</b> ` : `</b>`\r\n      } 共 <b style=\"color:${color};\">${seledRows.length}</b> 条记录？`;\r\n      ElMessageBox.confirm(hintTips, \"温馨提示\", {\r\n        type: name === \"delete\" ? \"error\" : \"warning\",\r\n        dangerouslyUseHTMLString: true,\r\n        closeOnClickModal: false,\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        confirmButtonClass: `el-button--${colorType}`,\r\n        cancelButtonClass: `el-button--${colorType} is-plain`,\r\n        draggable: true,\r\n      })\r\n        .then(() => {\r\n          const exportRows: any[] = [];\r\n          if (name === \"export\") {\r\n            const newCols = (cols?.filter((it: TableField) => {\r\n              if (typeOf(it) !== \"Object\") return false;\r\n              return !(it as TableColAttrs)?.prop?.startsWith(\"$\");\r\n            }) || []) as TableColAttrs[];\r\n            exportRows.push(newCols.map((it: TableColAttrs) => it.label));\r\n            seledRows.forEach((row: CommonObj) => {\r\n              const list: string[] = [];\r\n              newCols.forEach((col: TableColAttrs) => {\r\n                const { prop, type, formatter } = col;\r\n                let val = \"\";\r\n                if (allowList.includes(type)) {\r\n                  val = formatter ? formatter(row) : row[prop as string] ?? \"\";\r\n                }\r\n                list.push(val);\r\n              });\r\n              exportRows.push(list);\r\n            });\r\n          }\r\n          emits(\"extraBtn\", name, next, {\r\n            selectedKeys: seledKeys,\r\n            selectedRows: seledRows,\r\n            exportRows,\r\n          });\r\n        })\r\n        .catch(() => {});\r\n    }\r\n  } else if (name === \"import\") {\r\n    // () => import(\"./_components/ImportPopup.vue\"),\r\n    openPopup(\"温馨提示\", h(ImportPopup, { tplCfg: importCfg, onChange: (arr: CommonObj[]) => emits(\"click\", name, arr) }));\r\n  } else {\r\n    emits(\"extraBtn\", name, next, {\r\n      selectedKeys: [],\r\n      selectedRows: [],\r\n      exportRows: [],\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 是否需要push某特殊列\r\n */\r\nexport function needPushSpecialCol(key: SpecialBoolColType, props: CommonObj) {\r\n  const { groupBtns, cols = [] } = props;\r\n  if (key === \"operate\") {\r\n    return groupBtns && cols.slice(-1)?.[0]?.type !== \"operate\";\r\n  } else {\r\n    const isShow = props[key as keyof typeof props];\r\n    return isShow && !cols.find((it: CommonObj) => it.type === key);\r\n  }\r\n}\r\n\r\n/**\r\n * 获取查询条件的文本值\r\n */\r\nexport function getQueryFieldValue(field: FormFieldAttrs, val: any) {\r\n  const { attrs, type = defaultFormItemType, options = [] } = field;\r\n  if (type === \"cascader\") {\r\n    return typeOf(val) === \"Array\" ? getLabelFromOptionsByAllValues(options, val) : getLabelFromOptionsByLastValue(options, val);\r\n  } else if (type === \"select\") {\r\n    if (attrs?.multiple) {\r\n      const opts = options.filter(it => val.includes(it.value));\r\n      return opts.map(it => it.label).join(\"、\");\r\n    } else {\r\n      return getLabelFromOptionsByLastValue(options, val);\r\n    }\r\n  } else if (type === \"BaseNumberRange\") {\r\n    return val?.join(rangeJoinChar);\r\n  } else if (type === \"date-picker\") {\r\n    return val?.join(rangeJoinChar);\r\n  } else {\r\n    return val;\r\n  }\r\n}\r\n\r\n//获取每一行的分组按钮\r\nexport function getTempGroupBtnsOfRow(row: CommonObj, $rowInd: number, groupBtns: any) {\r\n  const isFn = typeOf(groupBtns) === \"Function\";\r\n  const btns = isFn ? (groupBtns as any)(row, $rowInd) : groupBtns;\r\n  const tempBtns = btns?.map((btn: BaseBtnType) => getBtnObj(btn, row))?.filter((it: BtnItem) => !!it.name);\r\n  return tempBtns ?? [];\r\n}\r\n"],"names":["batchBtnNames","allowList","handleClickExtraBtns","btnObj","cols","seledRows","seledKeys","total","exportCfg","emits","next","openPopup","importCfg","name","text","attrs","customRules","selectedKeys","selectedRows","exportRows","colorType","type","colorKey","upperFirst","color","cssVars","includes","isSeledAll","length","isOverLimit","limit","showMessage","message","dangerouslyUseHTMLString","hintTips","ElMessageBox","confirm","closeOnClickModal","confirmButtonText","cancelButtonText","confirmButtonClass","cancelButtonClass","draggable","then","newCols","filter","it","typeOf","_a","prop","startsWith","push","map","label","forEach","row","list","col","formatter","val","catch","h","ImportPopup","tplCfg","onChange","arr","needPushSpecialCol","key","props","groupBtns","_b","slice","find","getQueryFieldValue","field","defaultFormItemType","options","getLabelFromOptionsByAllValues","getLabelFromOptionsByLastValue","multiple","value","join","rangeJoinChar","getTempGroupBtnsOfRow","$rowInd","btns","btn","getBtnObj"],"mappings":"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"}