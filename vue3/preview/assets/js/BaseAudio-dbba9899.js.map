{"version":3,"file":"BaseAudio-dbba9899.js","sources":["../../../src/components/BaseAudio.vue"],"sourcesContent":["<!-- 语音播放组件面板 -->\r\n<template>\r\n  <div class=\"base-audio f-sb-c\" :class=\"{ default: !$slots.default }\">\r\n    <slot\r\n      :playing=\"playing\"\r\n      :muted=\"muted\"\r\n      :currentTime=\"audioRef?.currentTime || 0\"\r\n      :duration=\"audioRef?.duration || 0\"\r\n      :timeStr=\"timeStr\"\r\n      :progress=\"progress\"\r\n      :play=\"play\"\r\n      :pause=\"pause\"\r\n      :togglePlaying=\"togglePlaying\"\r\n      :toggleMuted=\"toggleMuted\"\r\n      :formatTime=\"formatTime\"\r\n    >\r\n      <BaseIcon\r\n        @click=\"togglePlaying\"\r\n        size=\"20\"\r\n        class=\"f-0 btn\"\r\n        :class=\"{ disabled }\"\r\n        :name=\"playing ? 'VideoPause' : 'VideoPlay'\"\r\n      />\r\n      <time class=\"f-0 ml-h\">{{ timeStr }}</time>\r\n      <el-slider\r\n        @change=\"handleSliderChange\"\r\n        @input=\"handleSliderInput\"\r\n        v-model=\"progress\"\r\n        :show-tooltip=\"false\"\r\n        :disabled=\"disabled\"\r\n        class=\"f-1 ml-o\"\r\n        v-if=\"showProgress\"\r\n      />\r\n      <el-tooltip :content=\"muted ? '取消静音' : '静音'\" :show-after=\"400\" :disabled=\"disabled\">\r\n        <BaseIcon\r\n          @click=\"toggleMuted\"\r\n          size=\"20\"\r\n          class=\"btn f-0 ml-h\"\r\n          :class=\"{ disabled }\"\r\n          :name=\"muted ? 'Mute' : 'Microphone'\"\r\n        />\r\n      </el-tooltip>\r\n    </slot>\r\n    <audio\r\n      @canplay=\"handleCanPlay\"\r\n      @timeupdate=\"handleTimeupdate\"\r\n      @ended=\"handleEnded\"\r\n      :muted=\"muted\"\r\n      controls\r\n      hidden\r\n      ref=\"audioRef\"\r\n      v-if=\"src\"\r\n    >\r\n      <source :src=\"src\" type=\"audio/mpeg\" />\r\n      <source :src=\"src\" type=\"audio/ogg\" />\r\n      您的浏览器不支持音频播放\r\n    </audio>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\n/**\r\n * 参考地址：\r\n * https://blog.csdn.net/lhz_19/article/details/122428176\r\n * https://blog.csdn.net/lhz_19/article/details/122428176\r\n */\r\nimport { ref, reactive, watch, computed } from \"vue\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"BaseAudio\" }); \n\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    src?: string;\r\n    showProgress?: boolean;\r\n    default?: boolean;\r\n  }>(),\r\n  {\r\n    default: true,\r\n    showProgress: true,\r\n    // src: \"http://files.xiangqinjiaoapp.com/user/voice/2022-10-26/sKHFUKQiaOeZwgtwUjh5rq3FNoIKQ90y.aac\",\r\n  }\r\n);\r\nconst audioRef = ref<any>(null);\r\nconst playing = ref(false);\r\nconst progress = ref(0);\r\nconst muted = ref(false);\r\nconst timeStr = ref(\"00:00/00:00\");\r\nconst disabled = ref(true);\r\n//当音频资源加载完毕，可以播放时的处理\r\nfunction handleCanPlay(e: any) {\r\n  const { currentTime, duration } = audioRef.value;\r\n  timeStr.value = `${formatTime(currentTime)}/${formatTime(duration)}`;\r\n  disabled.value = !duration;\r\n}\r\n// 更新进度条与当前播放时间\r\nfunction handleTimeupdate(e: any) {\r\n  const { currentTime, duration } = audioRef.value;\r\n  timeStr.value = `${formatTime(currentTime)}/${formatTime(duration)}`;\r\n  progress.value = (currentTime / duration) * 100;\r\n}\r\n//播放结束时\r\nfunction handleEnded() {\r\n  playing.value = false;\r\n  timeStr.value = `00:00/${formatTime(audioRef.value.duration)}`;\r\n}\r\n//滑块拖动停止时\r\nfunction handleSliderChange(val: number) {\r\n  const { duration } = audioRef.value;\r\n  audioRef.value.currentTime = duration * ((val as number) / 100);\r\n  play();\r\n}\r\n//滑块拖动时\r\nfunction handleSliderInput(val: number) {\r\n  const { duration } = audioRef.value;\r\n  const currentTime = duration * ((val as number) / 100);\r\n  timeStr.value = `${formatTime(currentTime)}/${formatTime(duration)}`;\r\n  pause();\r\n}\r\n//切换播放状态\r\nfunction togglePlaying() {\r\n  playing.value ? pause() : play();\r\n}\r\n//切换静音\r\nfunction toggleMuted() {\r\n  if (disabled.value) return;\r\n  muted.value = !muted.value;\r\n}\r\n//格式化时间\r\nfunction formatTime(time: number) {\r\n  time = Math.round(time);\r\n  const m = Math.floor(time / 60);\r\n  const s = time % 60;\r\n  const arr = [m, s].map(it => (it < 10 ? \"0\" : \"\") + it);\r\n  return arr.join(\":\");\r\n}\r\n//播放\r\nfunction play() {\r\n  if (disabled.value) return;\r\n  playing.value = true;\r\n  audioRef.value.play();\r\n}\r\n//暂停\r\nfunction pause() {\r\n  if (disabled.value) return;\r\n  playing.value = false;\r\n  audioRef.value.pause();\r\n}\r\n//暴露方法名、变量等，后续可能会用到\r\ndefineExpose({\r\n  playing,\r\n  progress,\r\n  timeStr,\r\n  muted,\r\n  play,\r\n  pause,\r\n  audioCtx: audioRef,\r\n  toggleMuted,\r\n  formatTime,\r\n});\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.base-audio {\r\n  &.default {\r\n    width: 100%;\r\n    border-radius: 40px;\r\n    height: 28px;\r\n    padding: 0 12px;\r\n    background: #eee;\r\n    .btn {\r\n      cursor: pointer;\r\n      &:hover {\r\n        color: $color-primary;\r\n      }\r\n      &.disabled {\r\n        cursor: not-allowed;\r\n        &:hover {\r\n          color: $color-text-main;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["audioRef","ref","playing","progress","muted","timeStr","disabled","handleCanPlay","e","currentTime","duration","value","formatTime","handleTimeupdate","handleEnded","handleSliderChange","val","handleSliderInput","togglePlaying","pause","play","toggleMuted","time","Math","round","floor","map","it","join","__expose","audioCtx"],"mappings":"inDAiFM,MAAAA,EAAWC,EAAS,MACpBC,EAAUD,GAAI,GACdE,EAAWF,EAAI,GACfG,EAAQH,GAAI,GACZI,EAAUJ,EAAI,eACdK,EAAWL,GAAI,GAErB,SAASM,EAAcC,GACrB,MAAMC,YAAEA,EAAAC,SAAaA,GAAaV,EAASW,MACnCN,EAAAM,MAAQ,GAAGC,EAAWH,MAAgBG,EAAWF,KACzDJ,EAASK,OAASD,CACpB,CAEA,SAASG,EAAiBL,GACxB,MAAMC,YAAEA,EAAAC,SAAaA,GAAaV,EAASW,MACnCN,EAAAM,MAAQ,GAAGC,EAAWH,MAAgBG,EAAWF,KAChDP,EAAAQ,MAASF,EAAcC,EAAY,GAC9C,CAEA,SAASI,IACPZ,EAAQS,OAAQ,EAChBN,EAAQM,MAAQ,SAASC,EAAWZ,EAASW,MAAMD,WACrD,CAEA,SAASK,EAAmBC,GACpB,MAAAN,SAAEA,GAAaV,EAASW,MACrBX,EAAAW,MAAMF,YAAcC,GAAaM,EAAiB,QAE7D,CAEA,SAASC,EAAkBD,GACnB,MAAAN,SAAEA,GAAaV,EAASW,MACxBF,EAAcC,GAAaM,EAAiB,KAC1CX,EAAAM,MAAQ,GAAGC,EAAWH,MAAgBG,EAAWF,QAE3D,CAEA,SAASQ,IACChB,EAAAS,MAAQQ,IAAUC,GAC5B,CAEA,SAASC,IACHf,EAASK,QACPP,EAAAO,OAASP,EAAMO,MACvB,CAEA,SAASC,EAAWU,GACXA,EAAAC,KAAKC,MAAMF,GAIX,MADK,CAFFC,KAAKE,MAAMH,EAAO,IAClBA,EAAO,IACEI,KAAIC,IAAOA,EAAK,GAAK,IAAM,IAAMA,IACzCC,KAAK,IAClB,CAEA,SAASR,IACHd,EAASK,QACbT,EAAQS,OAAQ,EAChBX,EAASW,MAAMS,OACjB,CAEA,SAASD,IACHb,EAASK,QACbT,EAAQS,OAAQ,EAChBX,EAASW,MAAMQ,QACjB,QAEaU,EAAA,CACX3B,UACAC,WACAE,UACAD,QACAgB,OACAD,QACAW,SAAU9B,EACVqB,cACAT"}