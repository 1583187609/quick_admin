{"version":3,"file":"index-dc1f83ac.js","sources":["../../../src/views/test/test-8/index.vue"],"sourcesContent":["<!-- 页面-聊天记录 -->\r\n<!-- :pageAttrs=\"{ pageSizes: [5, 10, 15, 20, 25] }\"\r\n    :pagination=\"{ currPage: 1, pageSize: 10 }\" -->\r\n<template>\r\n  <CustomCrud\r\n    v-model=\"model\"\r\n    :fields=\"fields\"\r\n    :fetch=\"getFromUserList\"\r\n    :pageAttrs=\"{ pageSizes: [5, 10, 15, 20, 25] }\"\r\n    :pagination=\"{ currPage: 1, pageSize: 10 }\"\r\n    :showPagination=\"false\"\r\n  >\r\n    <template #list=\"{ list, total, hasMore }\">\r\n      <div class=\"f-sb-s f-1\" style=\"height: 100%\">\r\n        <section class=\"section f-1 f-fs-s-c\">\r\n          <header class=\"header f-c-c f-0\">\r\n            <b>搜索结果 ({{ fromUserInfo.list.length }}/{{ fromUserInfo.total }})</b>\r\n          </header>\r\n          <LoadMore\r\n            class=\"f-1\"\r\n            @reachBottom=\"handleReachBottom('from')\"\r\n            :paddingBottom=\"fromUserInfo.hasMore ? 0 : paddingBottom\"\r\n            :loading=\"fromUserInfo.loading\"\r\n            emptyTips=\"换个姿势搜搜看~\"\r\n          >\r\n            <UserItem\r\n              userDataKey=\"fromUserData\"\r\n              @click=\"handleChangeActive('from', row)\"\r\n              :data=\"row\"\r\n              :active=\"fromUserInfo.activeId === row?.fromUserData?.id\"\r\n              isSearchResult\r\n              v-for=\"(row, ind) in fromUserInfo.list\"\r\n              :key=\"ind\"\r\n            />\r\n          </LoadMore>\r\n        </section>\r\n        <section class=\"section f-1 f-fs-s-c\">\r\n          <header class=\"header f-c-c f-0\">\r\n            <b>TA的好友 ({{ toUserInfo.list.length }}/{{ toUserInfo.total }})</b>\r\n          </header>\r\n          <LoadMore\r\n            class=\"f-1\"\r\n            @reachBottom=\"handleReachBottom('to')\"\r\n            :paddingBottom=\"toUserInfo.hasMore ? 0 : paddingBottom\"\r\n            :loading=\"toUserInfo.loading\"\r\n            :emptyTips=\"fromUserInfo.activeId ? '暂无好友哦~' : '请在左侧选择用户'\"\r\n          >\r\n            <UserItem\r\n              userDataKey=\"toUserData\"\r\n              @click=\"handleChangeActive('to', row)\"\r\n              :data=\"row\"\r\n              :active=\"toUserInfo.activeId === row.toUserData.id\"\r\n              v-for=\"(row, ind) in toUserInfo.list\"\r\n              :key=\"ind\"\r\n            />\r\n          </LoadMore>\r\n        </section>\r\n        <section class=\"section f-2 f-fs-s-c\">\r\n          <header class=\"header f-sb-fe f-0\">\r\n            <div class=\"f-fs-c\">\r\n              <div class=\"f-fs-c\">\r\n                【\r\n                <el-tooltip :content=\"chatInfo.headInfo.fromUser.nickname\">\r\n                  <span class=\"nickname line-1\">{{ chatInfo.headInfo.fromUser.nickname || \"-\" }}</span> </el-tooltip\r\n                >】\r\n              </div>\r\n              <div>与</div>\r\n              <div class=\"f-fs-c\">\r\n                【\r\n                <el-tooltip :content=\"chatInfo.headInfo.toUser.nickname\">\r\n                  <span class=\"nickname line-1\">{{ chatInfo.headInfo.toUser.nickname || \"-\" }}</span>\r\n                </el-tooltip>\r\n                】\r\n              </div>\r\n              <div class=\"line-1\">的聊天记录</div>\r\n            </div>\r\n            <!-- <div class=\"first-time f-0\">\r\n              首次建立会话时间：{{chatInfo.headInfo.firstDate || '-'}}\r\n            </div> -->\r\n            <el-tooltip :content=\"'首次建立会话时间：' + chatInfo.headInfo.firstDate\">\r\n              <span class=\"first-time line-1\">{{ chatInfo.headInfo.firstDate }}</span>\r\n            </el-tooltip>\r\n            <el-button\r\n              @click=\"openSearchChat(chatInfo.headInfo.fromUser, chatInfo.headInfo.toUser, model.msgWord)\"\r\n              :icon=\"Search\"\r\n              size=\"small\"\r\n              :disabled=\"!toUserInfo.activeId\"\r\n              type=\"primary\"\r\n              class=\"ml-o\"\r\n              plain\r\n              round\r\n              >搜索</el-button\r\n            >\r\n          </header>\r\n          <LoadMore\r\n            class=\"f-1\"\r\n            padding-top=\"16\"\r\n            :paddingBottom=\"chatInfo.hasMore ? 16 : paddingBottom\"\r\n            :loading=\"chatInfo.loading\"\r\n            :topHasMore=\"chatInfo.prevHasMore\"\r\n            @reach-top=\"handleChatReach('prev')\"\r\n            @reach-bottom=\"handleChatReach('next')\"\r\n            :emptyTips=\"toUserInfo.activeId ? '暂无聊天记录哦~' : '请在左侧选择TA的好友'\"\r\n          >\r\n            <template v-for=\"(row, ind) in chatInfo.list\" :key=\"ind\">\r\n              <div class=\"tips time\" v-if=\"isShowDateStr(row, ind)\">\r\n                {{ getDateStr(row.createdAt) }}\r\n              </div>\r\n              <MsgItem\r\n                :data=\"row\"\r\n                :userInfo=\"chatInfo.headInfo[`${toUserInfo.activeId === row.fromUser.id ? 'to' : 'from'}User`]\"\r\n                :position=\"\r\n                  row.msgType === 'TIMCustomElem' && !doubleTypes.includes(row.msgContent?.Data?.type)\r\n                    ? 'center'\r\n                    : toUserInfo.activeId === row.fromUser.id\r\n                    ? 'left'\r\n                    : 'right'\r\n                \"\r\n              />\r\n            </template>\r\n          </LoadMore>\r\n        </section>\r\n      </div>\r\n    </template>\r\n  </CustomCrud>\r\n</template>\r\n<script lang=\"ts\" name=\"ChatRecords\" setup>\r\nimport { ref, reactive, inject, watch } from \"vue\";\r\nimport { GetImSearchFromUserList, GetImSearchFriendList, GetImSearchP2pChatList } from \"@/api-mock\";\r\nimport { Search } from \"@element-plus/icons-vue\";\r\nimport CustomCrud from \"@/components/CustomCrud/Index.vue\";\r\nimport { FormField } from \"@/components/BaseFormItem\";\r\nimport UserItem from \"./_components/UserItem.vue\";\r\nimport MsgItem from \"./_components/MsgItem/Index.vue\";\r\nimport { useSelectOpts } from \"@/hooks\";\r\nimport { CommonObj, StrNum } from \"@/vite-env\";\r\nimport LoadMore from \"@/components/LoadMore.vue\";\r\nimport dayjs from \"dayjs\";\r\nimport SearchMsg from \"./_components/SearchMsg.vue\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"ChatRecords\" }); \n\r\n\r\ntype ChatListQueryDirection = \"prev\" | \"next\"; //prev 向上/以前（默认） next向下/以后\r\nconst { getSearchOpts } = useSelectOpts();\r\nconst openPopup: any = inject(\"openPopup\");\r\nconst paddingBottom = 250;\r\nconst doubleTypes = [8001, 8003, 8004, 8005, 8006];\r\nconst model = reactive<CommonObj>({});\r\nconst fromUserInfo = reactive<CommonObj>({\r\n  loading: false,\r\n  activeId: \"\",\r\n  list: [],\r\n  hasMore: true,\r\n  total: 0,\r\n  params: {\r\n    page: 1,\r\n    pageSize: 10,\r\n  },\r\n});\r\nconst toUserInfo = reactive<CommonObj>({\r\n  loading: false,\r\n  activeId: \"\",\r\n  list: [],\r\n  hasMore: true,\r\n  total: 0,\r\n  params: {\r\n    page: 1,\r\n    pageSize: 10,\r\n  },\r\n});\r\nconst chatInfo = reactive<CommonObj>({\r\n  loading: false,\r\n  list: [],\r\n  prevHasMore: true,\r\n  nextHasMore: false,\r\n  total: 0,\r\n  params: {\r\n    // page: 1,\r\n    pageSize: 20,\r\n    prevCreatedAt: 0,\r\n  },\r\n  headInfo: {\r\n    fromUser: {},\r\n    toUser: {},\r\n    firstDate: \"\",\r\n  },\r\n});\r\nconst fields: FormField[] = [\r\n  { prop: \"fromUserId\", label: \"用户ID\" },\r\n  { prop: \"fromUserCode\", label: \"号码牌\" },\r\n  { prop: \"fromUserNickname\", label: \"昵称\" },\r\n  { prop: \"toUserId\", label: \"好友ID\" },\r\n  { prop: \"msgWord\", label: \"关键词\" },\r\n  { prop: \"friendNumScope\", label: \"好友数量\", type: \"BaseNumberRange\" },\r\n  getSearchOpts(\"school\", { prop: \"fromUserSchoolId\", label: \"学校\" }),\r\n  getSearchOpts(\"company\", { prop: \"fromUserCompanyId\", label: \"公司\" }),\r\n  { prop: \"fromUserRegisterTimeScope\", label: \"注册时间\", type: \"date-picker\" },\r\n  { prop: \"chatTimeScope\", label: \"会话时间\", type: \"date-picker\" },\r\n];\r\nwatch(\r\n  () => fromUserInfo.activeId,\r\n  newFromActiveId => {\r\n    toUserInfo.params.page = 1;\r\n    toUserInfo.activeId = \"\";\r\n    toUserInfo.list = [];\r\n    chatInfo.list = [];\r\n    getToUserList(newFromActiveId);\r\n  },\r\n  { immediate: true }\r\n);\r\nwatch(\r\n  () => toUserInfo.activeId,\r\n  async newToId => {\r\n    if (newToId) {\r\n      const keyWord = model.msgWord;\r\n      const fromId = fromUserInfo.activeId;\r\n      const result = await isOpenSearchMsgPopup(fromId, newToId, keyWord);\r\n      if (result) {\r\n        const { fromUser, toUser } = result;\r\n        openSearchChat(fromUser, toUser, keyWord);\r\n      } else {\r\n        chatInfo.params.prevCreatedAt = 0;\r\n        getChatList(fromUserInfo.activeId, newToId);\r\n      }\r\n    } else {\r\n      chatInfo.list = [];\r\n    }\r\n  },\r\n  { immediate: false }\r\n);\r\n//是否显示日期\r\nfunction isShowDateStr(row: CommonObj, ind: number, gap = 3 * 60 * 1000) {\r\n  return ind === 0 || chatInfo.list[ind - 1].createdAt < row.createdAt - gap;\r\n}\r\n//发送消息的时间\r\nfunction getDateStr(time: number) {\r\n  // const y = dayjs().diff(dayjs(time), \"years\");\r\n  // const M = dayjs().diff(dayjs(time), \"months\");\r\n  // const d = dayjs().diff(dayjs(time), \"days\");\r\n  const h = dayjs().diff(dayjs(time), \"hours\");\r\n  const m = dayjs().diff(dayjs(time), \"minutes\");\r\n  // const s = dayjs().diff(dayjs(time), \"seconds\");\r\n  if (h > 1) {\r\n    return dayjs(time).format(\"YYYY-MM-DD HH:mm:ss\");\r\n  } else {\r\n    return m > 1 ? `${m}分钟前` : \"刚刚\";\r\n  }\r\n}\r\n\r\n//搜索结果列表\r\nasync function getFromUserList(params: CommonObj) {\r\n  const { hasMore, list: oldList } = fromUserInfo;\r\n  const { page } = fromUserInfo.params;\r\n  if (!hasMore && page !== 1) return;\r\n\r\n  fromUserInfo.loading = true;\r\n\r\n  try {\r\n    const res: CommonObj = await GetImSearchFromUserList(params);\r\n    const { list: newList, total, hasMore, currentPage } = res;\r\n    currentPage === 1 && (fromUserInfo.params.page = 1);\r\n    Object.assign(\r\n      fromUserInfo,\r\n      {\r\n        list: currentPage === 1 ? newList : oldList.concat(newList),\r\n        total,\r\n        hasMore,\r\n      },\r\n      currentPage === 1 ? { activeId: newList?.[0]?.fromUserData?.id ?? \"\" } : undefined\r\n    );\r\n    // return res;\r\n  } catch (err) {\r\n    console.error(err);\r\n  } finally {\r\n    fromUserInfo.loading = false;\r\n  }\r\n}\r\n\r\n// Ta的好友列表\r\nfunction getToUserList(fromUserId: number) {\r\n  if (!fromUserId) return;\r\n  const { hasMore, list: oldList, params } = toUserInfo;\r\n  const { page } = params;\r\n  if (!hasMore && page !== 1) {\r\n    return;\r\n  }\r\n  toUserInfo.loading = true;\r\n  GetImSearchFriendList({\r\n    fromUserId,\r\n    msgWord: model.msgWord,\r\n    chatTimeScope: model.chatTimeScope,\r\n    ...params,\r\n  })\r\n    .then((res: CommonObj) => {\r\n      const { list: newList, total, hasMore, currentPage } = res;\r\n      currentPage === 1 && (toUserInfo.params.page = 1);\r\n      Object.assign(toUserInfo, {\r\n        list: currentPage === 1 ? newList : oldList.concat(newList),\r\n        total,\r\n        hasMore,\r\n      });\r\n    })\r\n    .finally(() => {\r\n      toUserInfo.loading = false;\r\n    });\r\n}\r\n//聊天记录列表\r\nfunction getChatList(fromUserId: number, toUserId: number, direction: ChatListQueryDirection = \"prev\") {\r\n  if (!fromUserId || !toUserId) return;\r\n  const { prevHasMore, nextHasMore, list: oldList, params } = chatInfo;\r\n  const { page, prevCreatedAt } = params;\r\n  const isFirstPage = prevCreatedAt === 0;\r\n  if (!isFirstPage) {\r\n    if (direction === \"next\" && !nextHasMore) {\r\n      return;\r\n    } else if (direction === \"prev\" && !prevHasMore) {\r\n      return;\r\n    }\r\n  }\r\n  chatInfo.loading = true;\r\n  GetImSearchP2pChatList({\r\n    fromUserId,\r\n    toUserId,\r\n    queryDirection: direction,\r\n    ...params,\r\n  })\r\n    .then((res: CommonObj) => {\r\n      const { list, total, hasMore, firstDate, fromUser, toUser } = res;\r\n      const newList = list.map(item => {\r\n        const { msgContent = {}, ...rest } = item;\r\n        const { Data, Ext } = item.msgContent;\r\n        msgContent.Data = JSON.parse(Data || \"{}\");\r\n        msgContent.Ext = JSON.parse(Ext || \"{}\");\r\n        return {\r\n          fromUser: fromUser.id === item.fromUserId ? fromUser : toUser,\r\n          toUser: toUser.id === item.toUserId ? toUser : fromUser,\r\n          msgContent,\r\n          ...rest,\r\n        };\r\n      });\r\n      // console.log(newList, \"newList-------------\");\r\n      const _list = isFirstPage ? newList : direction === \"next\" ? [...oldList, ...newList] : [...newList, ...oldList];\r\n      Object.assign(chatInfo, {\r\n        list: _list,\r\n        total,\r\n        [`${direction}HasMore`]: hasMore,\r\n        headInfo: {\r\n          firstDate,\r\n          fromUser,\r\n          toUser,\r\n        },\r\n      });\r\n    })\r\n    .finally(() => {\r\n      chatInfo.loading = false;\r\n    });\r\n}\r\n/**\r\n * 是否要自动打开消息搜索弹窗\r\n * @return 返回类型 null | { fromUser: CommonObj; toUser: CommonObj }\r\n */\r\nasync function isOpenSearchMsgPopup(\r\n  fromUserId: StrNum,\r\n  toUserId: StrNum,\r\n  keyWord: string\r\n): null | { fromUser: CommonObj; toUser: CommonObj } {\r\n  if (keyWord) {\r\n    return await GetImSearchP2pChatList({\r\n      fromUserId,\r\n      toUserId,\r\n      msgWord: keyWord,\r\n    })\r\n      .then((res: CommonObj) => {\r\n        if (res?.list?.length >= 2) {\r\n          const { fromUser, toUser } = res;\r\n          return { fromUser, toUser };\r\n        } else {\r\n          return null;\r\n        }\r\n      })\r\n      .catch(() => null);\r\n  }\r\n}\r\n//处理点击搜索结果、Ta的好友的用户项时\r\nfunction handleChangeActive(type: \"from\" | \"to\", row: CommonObj) {\r\n  if (type === \"from\") {\r\n    fromUserInfo.activeId = row?.fromUserData?.id;\r\n    toUserInfo.params.page = 1;\r\n  } else if (type === \"to\") {\r\n    toUserInfo.activeId = row.toUserData.id;\r\n    Object.assign(chatInfo, {\r\n      nextHasMore: true,\r\n      prevHasMore: true,\r\n      prevCreatedAt: 0,\r\n    });\r\n  }\r\n}\r\n//触底事件\r\nfunction handleReachBottom(type: \"from\" | \"to\") {\r\n  if (type === \"from\") {\r\n    fromUserInfo.params.page++;\r\n    getFromUserList({ ...model, ...fromUserInfo.params });\r\n  } else if (type === \"to\") {\r\n    toUserInfo.params.page++;\r\n    getToUserList(fromUserInfo.activeId);\r\n  }\r\n}\r\n//处理聊天列表触顶/触底事件\r\nfunction handleChatReach(direction: ChatListQueryDirection) {\r\n  const last = direction === \"prev\" ? chatInfo.list[0] : chatInfo.list.slice(-1)[0];\r\n  if (!last) return;\r\n  chatInfo.params.prevCreatedAt = last.createdAt + (direction === \"prev\" ? -1 : 1);\r\n  getChatList(fromUserInfo.activeId, toUserInfo.activeId, direction);\r\n}\r\n//打开聊天记录搜索对话框\r\nfunction openSearchChat(fromUser: CommonObj, toUser: CommonObj, keyWord?: string) {\r\n  openPopup(`【${fromUser.nickname || \"-\"}】与【${toUser.nickname || \"-\"}】的聊天记录搜索`, {\r\n    component: SearchMsg,\r\n    attrs: {\r\n      fromUser,\r\n      toUser,\r\n      keyWord,\r\n      onSelect: handleSearchSelectItem,\r\n    },\r\n  });\r\n}\r\n//处理搜索聊天记录时选中某个聊天项\r\nfunction handleSearchSelectItem(row: CommonObj, searchVal: string, next: () => void) {\r\n  // model.msgWord = searchVal;\r\n  // chatInfo.params.prevCreatedAt = 0;\r\n  chatInfo.list = [];\r\n  chatInfo.prevHasMore = true;\r\n  chatInfo.nextHasMore = true;\r\n  chatInfo.params.prevCreatedAt = row.createdAt + 1;\r\n  getChatList(fromUserInfo.activeId, toUserInfo.activeId);\r\n  next();\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n$padding-bottom: 250px;\r\n.section {\r\n  height: 100%;\r\n  border-radius: $radius-main;\r\n  background: #fff;\r\n  overflow: hidden;\r\n  @include shadow-main();\r\n  .header {\r\n    padding: $gap-half $gap;\r\n    border-bottom: $border-main;\r\n    .first-time {\r\n      color: $color-text-light;\r\n      font-size: 13px;\r\n      margin: 0 auto 0 $gap-half;\r\n    }\r\n  }\r\n  &:not(:last-child) {\r\n    margin-right: $gap-half;\r\n  }\r\n  &:nth-child(3) {\r\n    .header {\r\n      .nickname {\r\n        max-width: 10em;\r\n      }\r\n    }\r\n    .load-more {\r\n      padding: 0 $gap;\r\n      .tips {\r\n        padding: $gap-qtr 0;\r\n        text-align: center;\r\n        color: $color-text-light;\r\n        font-size: 13px;\r\n        &.time {\r\n        }\r\n        &.text {\r\n          font-size: 12px;\r\n        }\r\n      }\r\n      .time-box {\r\n      }\r\n      .message {\r\n        &:not(:last-child) {\r\n          margin-bottom: $gap-one-half;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["getSearchOpts","useSelectOpts","openPopup","inject","doubleTypes","model","reactive","fromUserInfo","loading","activeId","list","hasMore","total","params","page","pageSize","toUserInfo","chatInfo","prevHasMore","nextHasMore","prevCreatedAt","headInfo","fromUser","toUser","firstDate","fields","prop","label","type","isShowDateStr","row","ind","gap","createdAt","getDateStr","time","h","dayjs","diff","m","format","async","getFromUserList","oldList","res","GetImSearchFromUserList","newList","currentPage","Object","assign","concat","_b","_a","fromUserData","id","err","getToUserList","fromUserId","GetImSearchFriendList","msgWord","chatTimeScope","then","finally","getChatList","toUserId","direction","isFirstPage","GetImSearchP2pChatList","queryDirection","map","item","msgContent","rest","Data","Ext","JSON","parse","_list","handleChangeActive","toUserData","handleReachBottom","handleChatReach","last","slice","openSearchChat","keyWord","nickname","component","SearchMsg","attrs","onSelect","handleSearchSelectItem","searchVal","next","watch","newFromActiveId","immediate","newToId","fromId","result","length","catch","isOpenSearchMsgPopup"],"mappings":"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"}