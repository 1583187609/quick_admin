{"version":3,"file":"index-new-cb88a98a.js","sources":["../../../src/views/login/index-new.vue"],"sourcesContent":["<!-- 页面 - 登录 -->\r\n<template>\r\n  <div class=\"page f-c-c\">\r\n    <h1 class=\"h1\">{{ title }}</h1>\r\n    <div class=\"box f-fs-c\">\r\n      <!-- d=\"M 50 50 m -50 0 a 50 50 0 1 1 100 0 a 50 50 0 1 1 -100 0 z\" -->\r\n      <!-- d=\"M 0,50 a 50,50 0 1, 1 0, 1 z\" -->\r\n      <!-- <div class=\"circle\">\r\n        <svg class=\"svg\" viewBox=\"0 0 100 100\">\r\n          <path\r\n            d=\"M 50 50 m -50 0 a 50 50 0 1 1 100 0 a 50 50 0 1 1 -100 0 z\"\r\n            id=\"circle\"\r\n          />\r\n          <text>\r\n            <textPath xlink:href=\"#circle\">脱单计划管理后台</textPath>\r\n          </text>\r\n        </svg>\r\n      </div> -->\r\n      <div class=\"wrap f-c-c-c\">\r\n        <h2 class=\"h2 f-0\">{{ typeMap[type].title }}</h2>\r\n        <BaseForm\r\n          class=\"form f-0\"\r\n          v-model=\"model\"\r\n          :fields=\"fields\"\r\n          :submitText=\"typeMap[type].submitText\"\r\n          :loading=\"loading\"\r\n          :autoFixedFoot=\"false\"\r\n          @submit=\"handleSubmit\"\r\n          :key=\"type\"\r\n        >\r\n        </BaseForm>\r\n      </div>\r\n      <template v-if=\"type === 'login'\">\r\n        <div @click=\"type = 'register'\" class=\"btns f-c-c blue\">去注册</div>\r\n        <div @click=\"type = 'forget'\" class=\"btns f-c-c\">忘记密码</div>\r\n      </template>\r\n      <div @click=\"type = 'login'\" class=\"btns f-c-c\" v-else>去登录</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, inject, computed } from \"vue\";\r\nimport { PostUserLogin } from \"@/api-mock\";\r\nimport { FormField } from \"@/components/BaseFormItem\";\r\nimport { CommonObj, FinallyNext, StrNum } from \"@/vite-env\";\r\nimport CaptchaBtn from \"./_components/CaptchaBtn.vue\";\r\nimport { ElMessage, ElNotification } from \"element-plus\";\r\nimport BaseIcon from \"@/components/BaseIcon.vue\";\r\nimport { getUserInfo } from \"@/utils\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport { useUserStore } from \"@/store\";\r\nimport { h } from \"vue\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"LoginIndexNew\" }); \n\r\nexport type FormType = \"login\" | \"register\" | \"forget\";\r\n// const userStore = useUserStore();\r\nconst typeMap: CommonObj = {\r\n  login: {\r\n    title: \"登录\",\r\n    api: PostUserLogin,\r\n    submitText: \"登录\",\r\n  },\r\n  register: {\r\n    title: \"注册\",\r\n    api: PostUserLogin,\r\n    submitText: \"注册\",\r\n  },\r\n  forget: {\r\n    title: \"忘记密码\",\r\n    api: PostUserLogin,\r\n  },\r\n};\r\n// const props = withDefaults(defineProps<{}>(), {});\r\nconst type = ref<FormType>(\"login\");\r\nconst router = useRouter();\r\nconst route = useRoute();\r\nconst userStore = useUserStore();\r\nconst loading = ref(false);\r\nconst title = import.meta.env.VITE_APP_TITLE;\r\nconst redirect = ref(route.query.redirect?.toString() ?? \"/\");\r\nconst { login_account } = localStorage;\r\nconst model = reactive<CommonObj>({\r\n  account: login_account || \"\",\r\n  password: \"\",\r\n  remember: !!login_account,\r\n});\r\nconst fields = computed<FormField[]>(() => {\r\n  return [\r\n    {\r\n      prop: \"account\",\r\n      label: \"账号\",\r\n      required: true,\r\n      attrs: {\r\n        showWordLimit: false,\r\n      },\r\n      extra: {\r\n        // valid: \"phone\",\r\n      },\r\n      slots: {\r\n        prefix: h(BaseIcon, { name: \"User\", size: \"24\" }),\r\n      },\r\n    },\r\n    type.value !== \"login\" && {\r\n      prop: \"yzm\",\r\n      label: \"验证码\",\r\n      required: true,\r\n      class: \"captcha-box\",\r\n      attrs: {\r\n        maxlength: 4,\r\n        showWordLimit: false,\r\n      },\r\n      slots: {\r\n        prefix: h(BaseIcon, { name: \"Clock\", size: \"24\" }),\r\n        append: CaptchaBtn,\r\n      },\r\n    },\r\n    {\r\n      prop: \"password\",\r\n      label: \"密码\",\r\n      required: true,\r\n      extra: {\r\n        valid: \"password\",\r\n      },\r\n      slots: {\r\n        prefix: h(BaseIcon, { name: \"Lock\", size: \"24\" }),\r\n      },\r\n    },\r\n    type.value === \"register\" && {\r\n      prop: \"confirmPsd\",\r\n      label: \"确认密码\",\r\n      required: true,\r\n      rules: [{ validator: checkConfirmPsd, trigger: \"blur\" }],\r\n      attrs: {\r\n        placeholder: \"请再次输入密码\",\r\n      },\r\n      extra: {\r\n        valid: \"password\",\r\n      },\r\n      slots: {\r\n        prefix: h(BaseIcon, { name: \"Unlock\", size: \"24\" }),\r\n      },\r\n    },\r\n    type.value === \"login\" && {\r\n      prop: \"remember\",\r\n      label: \"记住我\",\r\n      type: \"checkbox\",\r\n      class: \"rember\",\r\n      attrs: {\r\n        size: \"large\",\r\n        // border: true,\r\n      },\r\n    },\r\n  ];\r\n});\r\n//校验两次输入的密码是否一致\r\nfunction checkConfirmPsd(rule: any, value: any, callback: any) {\r\n  if (value !== model.password) {\r\n    callback(new Error(\"确认密码和密码需要保持一致\"));\r\n  } else {\r\n    callback();\r\n  }\r\n}\r\n//处理表单提交\r\nfunction handleSubmit(params: any) {\r\n  const map: CommonObj = {\r\n    login: () => handleLogin(params),\r\n    register: () => handleRegister(params),\r\n    forget: () => handleForgetPsd(params),\r\n  };\r\n  map[type.value] ? map[type.value]() : ElMessage.warning(`点击了${type.value}按钮`);\r\n}\r\n//登录\r\nfunction handleLogin(params: CommonObj) {\r\n  loading.value = true;\r\n  userStore.handleLoginIn(params).finally(() => {\r\n    loading.value = false;\r\n  });\r\n}\r\n//注册\r\nfunction handleRegister(params: CommonObj) {\r\n  ElMessage.warning(\"注册功能暂未开通，敬请期待！\");\r\n}\r\n//找回密码\r\nfunction handleForgetPsd(params: CommonObj) {\r\n  ElMessage.warning(\"找回密码功能暂未开通，敬请期待！\");\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n$size: 600px;\r\n$ratio: 1; //500/350   1.43\r\n$transition-time: 0.5s;\r\n.page {\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: auto;\r\n  background: #eff0f4;\r\n}\r\n.h1 {\r\n  position: absolute;\r\n  font-size: 40px;\r\n  letter-spacing: 0.4em;\r\n  text-shadow: #999 2px 4px 10px;\r\n  transform: translate($ratio * -85px, $size * -0.5 - 50px);\r\n}\r\n.circle {\r\n  position: absolute;\r\n  top: -50px;\r\n  left: -50px;\r\n  // left: 50%;\r\n  // transform: translateX(-50%);\r\n  width: $size * 1.2;\r\n  height: $size * 0.5;\r\n  .svg {\r\n    font-size: 20px;\r\n    display: block;\r\n    overflow: visible;\r\n  }\r\n  path {\r\n    fill: none;\r\n  }\r\n}\r\n\r\n.box {\r\n  position: relative;\r\n  width: ($size + 170px) * $ratio;\r\n  .wrap {\r\n    position: relative;\r\n    width: $size * $ratio;\r\n    height: $size * $ratio;\r\n    box-shadow: inset 20px 20px 20px rgba(0, 0, 0, 0.05), 25px 35px 20px rgba(0, 0, 0, 0.05), 25px 30px 30px rgba(0, 0, 0, 0.5),\r\n      inset -20px -20px 25px rgba(255, 255, 255, 0.9);\r\n    transition: $transition-time;\r\n    border-radius: 52% 48% 33% 67%/38% 45% 55% 62%;\r\n    &:hover {\r\n      border-radius: 50%;\r\n    }\r\n    &::before {\r\n      content: \"\";\r\n      position: absolute;\r\n      top: 70px * $ratio;\r\n      left: 120px * $ratio;\r\n      width: 50px * $ratio;\r\n      height: 50px * $ratio;\r\n      border-radius: 50%;\r\n      background: #fff;\r\n      opacity: 0.5;\r\n    }\r\n    &::after {\r\n      content: \"\";\r\n      position: absolute;\r\n      top: 125px * $ratio;\r\n      left: 155px * $ratio;\r\n      width: 20px * $ratio;\r\n      height: 20px * $ratio;\r\n      border-radius: 50%;\r\n      background: #fff;\r\n      opacity: 0.5;\r\n    }\r\n    .h2 {\r\n      font-size: 26px * $ratio;\r\n      color: $color-primary;\r\n      line-height: 1;\r\n      letter-spacing: 0.2em;\r\n      margin-bottom: 22px * $ratio;\r\n    }\r\n  }\r\n  .btns {\r\n    position: absolute;\r\n    right: 0;\r\n    bottom: 0;\r\n    width: 170px * $ratio;\r\n    height: 170px * $ratio;\r\n    background: #c61dff;\r\n    cursor: pointer;\r\n    text-decoration: none;\r\n    color: #fff;\r\n    font-size: 16px;\r\n    transition: $transition-time;\r\n    border-radius: 44% 56% 65% 35%/57% 58% 42% 43%;\r\n    box-shadow: inset 10px 10px 10px rgba(190, 1, 254, 0.05), 15px 25px 10px rgba(190, 1, 254, 0.1),\r\n      15px 20px 20px rgba(190, 1, 254, 0.1), inset -10px -10px 15px rgba(255, 255, 255, 0.5);\r\n    &:hover {\r\n      border-radius: 50%;\r\n      font-size: 18px;\r\n    }\r\n    &::before {\r\n      content: \"\";\r\n      position: absolute;\r\n      top: 26px * $ratio;\r\n      left: 40px * $ratio;\r\n      width: 28px * $ratio;\r\n      height: 28px * $ratio;\r\n      border-radius: 50%;\r\n      background: #fff;\r\n      opacity: 0.5;\r\n    }\r\n  }\r\n  .blue {\r\n    bottom: 210px * $ratio;\r\n    right: 0px;\r\n    width: 110px * $ratio;\r\n    height: 110px * $ratio;\r\n    background: #01b4ff;\r\n    border-radius: 49% 51% 52% 48%/63% 59% 41% 37%;\r\n    box-shadow: inset 10px 10px 10px rgba(1, 180, 255, 0.05), 15px 25px 10px rgba(1, 180, 255, 0.1),\r\n      15px 20px 20px rgba(1, 180, 255, 0.1), inset -10px -10px 15px rgba(255, 255, 255, 0.5);\r\n    &::before {\r\n      top: 16px * $ratio;\r\n      left: 28px * $ratio;\r\n      width: 20px * $ratio;\r\n      height: 20px * $ratio;\r\n    }\r\n  }\r\n}\r\n.form {\r\n  position: reactive;\r\n  z-index: 1;\r\n  flex: 0;\r\n  width: 310px * $ratio;\r\n  :deep(.el-form-item__label) {\r\n    padding: 0;\r\n  }\r\n  :deep(.el-form-item:not(.rember)) {\r\n    position: relative;\r\n    border-radius: 30px * $ratio;\r\n    box-shadow: inset 2px 5px 10px rgba(0, 0, 0, 0.1), inset -2px -5px 10px rgba(255, 255, 255, 1),\r\n      15px 15px 10px rgba(0, 0, 0, 0.5), 15px 10px 15px rgba(0, 0, 0, 0.25);\r\n    background: #eff0f4;\r\n    margin-bottom: 36px * $ratio;\r\n    &::before {\r\n      content: \"\";\r\n      position: absolute;\r\n      top: 5px * $ratio;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      width: 60%;\r\n      height: 5px * $ratio;\r\n      background: rgba(255, 255, 255, 0.5);\r\n      border-radius: 3px * $ratio;\r\n    }\r\n  }\r\n  :deep(.el-input__wrapper) {\r\n    height: 54px * $ratio;\r\n    border-radius: 27px * $ratio;\r\n    background: transparent;\r\n    font-size: 18px;\r\n    // box-shadow: none;\r\n  }\r\n  :deep(.el-input-group__append) {\r\n    border-radius: 0 27px * $ratio 27px * $ratio 0;\r\n    flex-basis: 7em;\r\n    flex: 0;\r\n    font-size: 18px;\r\n    // font-size: 16px;\r\n    background: transparent;\r\n    &:hover {\r\n      color: $color-primary;\r\n    }\r\n  }\r\n  :deep(.captcha-box .el-input__wrapper) {\r\n    border-radius: 27px * $ratio 0 0 27px * $ratio;\r\n  }\r\n  :deep(.footer-btns) {\r\n    padding: 0;\r\n  }\r\n  :deep(.footer-btns .el-button) {\r\n    position: relative;\r\n    width: 36%;\r\n    margin: 0 7%;\r\n    height: 54px * $ratio;\r\n    font-size: 18px;\r\n    border-radius: 27px * $ratio;\r\n    transition: $transition-time;\r\n    box-shadow: inset 2px 5px 10px rgba(0, 0, 0, 0.1), inset -2px -5px 10px rgba(255, 255, 255, 1),\r\n      15px 15px 10px rgba(0, 0, 0, 0.5), 15px 10px 15px rgba(0, 0, 0, 0.25);\r\n    &::before {\r\n      content: \"\";\r\n      position: absolute;\r\n      top: 4px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      width: 55%;\r\n      height: 5px * $ratio;\r\n      background: rgba(255, 255, 255, 0.5);\r\n      border-radius: 3px * $ratio;\r\n    }\r\n    &:hover {\r\n      width: 50%;\r\n      margin: 0;\r\n    }\r\n    &:first-child {\r\n      box-shadow: inset 2px 5px 10px rgba(0, 0, 0, 0.1), inset -2px -5px 10px rgba(255, 255, 255, 0.25),\r\n        15px 15px 10px rgba(0, 0, 0, 0.5), 15px 10px 15px rgba(0, 0, 0, 0.25);\r\n    }\r\n  }\r\n  :deep(.el-form-item__label) {\r\n    display: none;\r\n    line-height: 54px;\r\n    height: 54px;\r\n    margin-right: $gap-half;\r\n  }\r\n  :deep(.el-input__inner) {\r\n    &:-webkit-autofill {\r\n      box-shadow: 0 0 0px 1000px #eff0f4 inset !important;\r\n      -webkit-text-fill-color: $color-text-main !important;\r\n    }\r\n  }\r\n  :deep(.el-form-item__error) {\r\n    margin-top: 14px * $ratio;\r\n  }\r\n}\r\n</style>\r\n"],"names":["typeMap","login","title","api","PostUserLogin","submitText","register","forget","type","ref","useRouter","route","useRoute","userStore","useUserStore","loading","VITE_APP_TITLE","_a","query","redirect","toString","login_account","localStorage","model","reactive","account","password","remember","fields","computed","prop","label","required","attrs","showWordLimit","extra","slots","prefix","h","BaseIcon","name","size","value","class","maxlength","append","CaptchaBtn","valid","rules","validator","checkConfirmPsd","trigger","placeholder","rule","callback","Error","handleSubmit","params","map","handleLoginIn","finally","handleLogin","ElMessage","warning"],"mappings":"2tDAyDA,MAAMA,EAAqB,CACzBC,MAAO,CACLC,MAAO,KACPC,IAAKC,EACLC,WAAY,MAEdC,SAAU,CACRJ,MAAO,KACPC,IAAKC,EACLC,WAAY,MAEdE,OAAQ,CACNL,MAAO,OACPC,IAAKC,IAIHI,EAAOC,EAAc,SACFC,IACzB,MAAMC,EAAQC,IACRC,EAAYC,IACZC,EAAUN,GAAI,GACdP,EAAwB,CAAA,EAAAc,eACbP,GAAI,OAAAQ,EAAMN,EAAAO,MAAMC,eAAZ,EAAAF,EAAsBG,aAAc,KACnD,MAAAC,cAAEA,GAAkBC,aACpBC,EAAQC,EAAoB,CAChCC,QAASJ,GAAiB,GAC1BK,SAAU,GACVC,WAAYN,IAERO,EAASC,GAAsB,IAC5B,CACL,CACEC,KAAM,UACNC,MAAO,KACPC,UAAU,EACVC,MAAO,CACLC,eAAe,GAEjBC,MAAO,CAEP,EACAC,MAAO,CACLC,OAAQC,EAAEC,EAAU,CAAEC,KAAM,OAAQC,KAAM,SAG/B,UAAfjC,EAAKkC,OAAqB,CACxBZ,KAAM,MACNC,MAAO,MACPC,UAAU,EACVW,MAAO,cACPV,MAAO,CACLW,UAAW,EACXV,eAAe,GAEjBE,MAAO,CACLC,OAAQC,EAAEC,EAAU,CAAEC,KAAM,QAASC,KAAM,OAC3CI,OAAQC,IAGZ,CACEhB,KAAM,WACNC,MAAO,KACPC,UAAU,EACVG,MAAO,CACLY,MAAO,YAETX,MAAO,CACLC,OAAQC,EAAEC,EAAU,CAAEC,KAAM,OAAQC,KAAM,SAG/B,aAAfjC,EAAKkC,OAAwB,CAC3BZ,KAAM,aACNC,MAAO,OACPC,UAAU,EACVgB,MAAO,CAAC,CAAEC,UAAWC,EAAiBC,QAAS,SAC/ClB,MAAO,CACLmB,YAAa,WAEfjB,MAAO,CACLY,MAAO,YAETX,MAAO,CACLC,OAAQC,EAAEC,EAAU,CAAEC,KAAM,SAAUC,KAAM,SAGjC,UAAfjC,EAAKkC,OAAqB,CACxBZ,KAAM,WACNC,MAAO,MACPvB,KAAM,WACNmC,MAAO,SACPV,MAAO,CACLQ,KAAM,aAOL,SAAAS,EAAgBG,EAAWX,EAAYY,GAC1CZ,IAAUnB,EAAMG,SACT4B,EAAA,IAAIC,MAAM,qBAIvB,CAEA,SAASC,EAAaC,GACpB,MAAMC,EAAiB,CACrBzD,MAAO,IAOX,SAAqBwD,GACnB1C,EAAQ2B,OAAQ,EAChB7B,EAAU8C,cAAcF,GAAQG,SAAQ,KACtC7C,EAAQ2B,OAAQ,CAAA,GAEpB,CAZiBmB,CAAYJ,GACzBnD,SAAU,KAcZwD,EAAUC,QAAQ,iBAdqB,EACrCxD,OAAQ,KAiBVuD,EAAUC,QAAQ,mBAjBoB,GAEtCL,EAAIlD,EAAKkC,OAASgB,EAAIlD,EAAKkC,SAAWoB,EAAUC,QAAQ,MAAMvD,EAAKkC,UACrE"}