{"version":3,"file":"_utils-cf6ebd0c.js","sources":["../../../src/components/table/_utils.ts"],"sourcesContent":["import { CommonObj, StrNum } from \"@/vite-env\";\r\nimport { typeOf, propsJoinChar, emptyTime, devErrorTips, emptyVals, renderValue } from \"@/components/_utils\";\r\nimport { TableField, TableColAttrs, defaultColumnAttrs } from \"@/components/table\";\r\nimport { merge } from \"lodash\";\r\nimport config from \"@/config\";\r\n\r\n/**\r\n * 获取特殊列\r\n */\r\nexport function getSpecialColMap(currPage: number = 1, pageSize: number = 20): CommonObj {\r\n  return Object.assign(\r\n    {\r\n      //序号列\r\n      index: {\r\n        prop: \"$index\",\r\n        label: \"序号\",\r\n        type: \"index\",\r\n        width: 54,\r\n        fixed: \"left\",\r\n        index: (ind: number) => ind + 1 + (currPage - 1) * pageSize,\r\n      },\r\n      //排序列\r\n      sort: {\r\n        prop: \"$sort\",\r\n        label: \"排序\",\r\n        type: \"sort\",\r\n        width: 54,\r\n        fixed: \"left\",\r\n      },\r\n      //多选列\r\n      selection: {\r\n        prop: \"$selection\",\r\n        label: \"选择\",\r\n        type: \"selection\",\r\n        width: 48,\r\n        fixed: \"left\",\r\n      },\r\n      //操作列\r\n      operate: {\r\n        prop: \"$operate\",\r\n        label: \"操作\",\r\n        type: \"operate\",\r\n        // minWidth: 250,\r\n        fixed: \"right\",\r\n      },\r\n      //id：唯一标识id\r\n      id: { prop: \"id\", label: \"ID\", minWidth: 70, fixed: \"left\" },\r\n      //备注列\r\n      remark: { prop: \"remark\", label: \"备注\", minWidth: 140 },\r\n      //创建列\r\n      create: {\r\n        prop: [\"createdName\", \"createdAt\"],\r\n        label: \"创建时间\",\r\n        minWidth: 160,\r\n      },\r\n      //修改列\r\n      update: {\r\n        prop: [\"updatedName\", \"updatedAt\"],\r\n        label: \"修改时间\",\r\n        minWidth: 160,\r\n      },\r\n      //switch开关\r\n      switch: {\r\n        prop: \"status\",\r\n        label: \"启用状态\",\r\n        minWidth: 80,\r\n        attrs: {\r\n          activeValue: 1,\r\n          inactiveValue: 0,\r\n          activeText: \"启用\",\r\n          inactiveText: \"禁用\",\r\n          inlinePrompt: true,\r\n          // onChange() {\r\n          //   ElMessage.warning(\"暂未处理【启用/禁用】事件\");\r\n          // },\r\n        },\r\n      },\r\n      //是否启用状态\r\n      BaseTag: {\r\n        prop: \"status\",\r\n        label: \"状态\",\r\n        minWidth: 90,\r\n        attrs: { name: \"EnableStatus\" },\r\n      },\r\n      //图片\r\n      BaseImg: {\r\n        prop: \"imgUrl\",\r\n        label: \"图片\",\r\n        minWidth: 136,\r\n        attrs: { size: \"120\" },\r\n      },\r\n      //文本省略显示，点击查看更多\r\n      BaseText: {\r\n        prop: \"content\",\r\n        label: \"内容\",\r\n        minWidth: 250,\r\n      },\r\n      // 文本复制\r\n      BaseCopy: {\r\n        minWidth: 190,\r\n      },\r\n      //用户信息\r\n      // UserInfo: {\r\n      //   prop: \"userData\",\r\n      //   label: \"用户信息\",\r\n      //   fixed: \"left\",\r\n      //   getAttrs(col: TableColAttrs) {\r\n      //     return {\r\n      //       width: col?.attrs?.simple ? 222 : 440,\r\n      //     };\r\n      //   },\r\n      // },\r\n    },\r\n    config?.table?.customSpecialCol\r\n  );\r\n}\r\n\r\n// 获取col和level\r\nexport function getColLevel(col: TableColAttrs, lev = 0, specialColMap: CommonObj, isSmall?: boolean): CommonObj {\r\n  let newLev = lev;\r\n  const { children, type, prop, label, minWidth } = col;\r\n  const specialColAttrs = specialColMap[type as string];\r\n  const { getAttrs } = specialColAttrs || {};\r\n  const newCol = merge(\r\n    {},\r\n    defaultColumnAttrs,\r\n    specialColAttrs,\r\n    typeof label === \"string\" &&\r\n      label?.includes(\"时间\") && {\r\n        minWidth: 164,\r\n        formatter:\r\n          type !== \"custom\" && typeof prop === \"string\"\r\n            ? (row: CommonObj) => renderValue(emptyTime === row[prop] ? undefined : row[prop])\r\n            : undefined,\r\n      },\r\n    getAttrs?.(col),\r\n    col\r\n  );\r\n  if (typeOf(newCol.prop) === \"Array\") {\r\n    newCol.prop = (newCol.prop as [string, string]).join(propsJoinChar);\r\n  }\r\n  //如果是小型的紧凑型，那么所有的宽度均要减少20px\r\n  if (isSmall) {\r\n    const { width, minWidth } = newCol;\r\n    width && (newCol.width -= 20);\r\n    minWidth && (newCol.minWidth -= 20);\r\n  }\r\n  // if (minWidth) {\r\n  //   delete newCol.width;\r\n  // }\r\n  if (children?.length) {\r\n    newCol.children = children.map((item: TableField) => {\r\n      if (typeOf(item) !== \"Object\") return 0;\r\n      const { col, level } = getColLevel(item as TableColAttrs, lev++, specialColMap, defaultColumnAttrs);\r\n      if (level > newLev) {\r\n        newLev = level;\r\n      }\r\n      return col;\r\n    });\r\n  }\r\n  return { col: newCol, level: newLev };\r\n}\r\n"],"names":["getSpecialColMap","currPage","pageSize","Object","assign","index","prop","label","type","width","fixed","ind","sort","selection","operate","id","minWidth","remark","create","update","switch","attrs","activeValue","inactiveValue","activeText","inactiveText","inlinePrompt","BaseTag","name","BaseImg","size","BaseText","BaseCopy","_b","_a","config","table","customSpecialCol","getColLevel","col","lev","specialColMap","isSmall","newLev","children","specialColAttrs","getAttrs","newCol","merge","defaultColumnAttrs","includes","formatter","row","renderValue","emptyTime","typeOf","join","propsJoinChar","length","map","item","level"],"mappings":"mLASO,SAASA,EAAiBC,EAAmB,EAAGC,EAAmB,YACxE,OAAOC,OAAOC,OACZ,CAEEC,MAAO,CACLC,KAAM,SACNC,MAAO,KACPC,KAAM,QACNC,MAAO,GACPC,MAAO,OACPL,MAAQM,GAAgBA,EAAM,GAAKV,EAAW,GAAKC,GAGrDU,KAAM,CACJN,KAAM,QACNC,MAAO,KACPC,KAAM,OACNC,MAAO,GACPC,MAAO,QAGTG,UAAW,CACTP,KAAM,aACNC,MAAO,KACPC,KAAM,YACNC,MAAO,GACPC,MAAO,QAGTI,QAAS,CACPR,KAAM,WACNC,MAAO,KACPC,KAAM,UAENE,MAAO,SAGTK,GAAI,CAAET,KAAM,KAAMC,MAAO,KAAMS,SAAU,GAAIN,MAAO,QAEpDO,OAAQ,CAAEX,KAAM,SAAUC,MAAO,KAAMS,SAAU,KAEjDE,OAAQ,CACNZ,KAAM,CAAC,cAAe,aACtBC,MAAO,OACPS,SAAU,KAGZG,OAAQ,CACNb,KAAM,CAAC,cAAe,aACtBC,MAAO,OACPS,SAAU,KAGZI,OAAQ,CACNd,KAAM,SACNC,MAAO,OACPS,SAAU,GACVK,MAAO,CACLC,YAAa,EACbC,cAAe,EACfC,WAAY,KACZC,aAAc,KACdC,cAAc,IAOlBC,QAAS,CACPrB,KAAM,SACNC,MAAO,KACPS,SAAU,GACVK,MAAO,CAAEO,KAAM,iBAGjBC,QAAS,CACPvB,KAAM,SACNC,MAAO,KACPS,SAAU,IACVK,MAAO,CAAES,KAAM,QAGjBC,SAAU,CACRzB,KAAM,UACNC,MAAO,KACPS,SAAU,KAGZgB,SAAU,CACRhB,SAAU,MAcd,OAAAiB,EAAA,OAAAC,EAAAC,QAAA,EAAAD,EAAQE,YAAO,EAAAH,EAAAI,iBAEnB,CAGO,SAASC,EAAYC,EAAoBC,EAAM,EAAGC,EAA0BC,GACjF,IAAIC,EAASH,EACb,MAAMI,SAAEA,EAAUpC,KAAAA,EAAAF,KAAMA,EAAMC,MAAAA,EAAAS,SAAOA,GAAauB,EAC5CM,EAAkBJ,EAAcjC,IAChCsC,SAAEA,GAAaD,GAAmB,GAClCE,EAASC,EAAAA,MACb,CAAC,EACDC,EACAJ,EACiB,iBAAVtC,IACL,MAAAA,OAAA,EAAAA,EAAO2C,SAAS,QAAS,CACvBlC,SAAU,IACVmC,UACW,WAAT3C,GAAqC,iBAATF,EACvB8C,GAAmBC,EAAYC,IAAcF,EAAI9C,QAAQ,EAAY8C,EAAI9C,SAC1E,GAEC,MAAXwC,OAAW,EAAAA,EAAAP,GACXA,GAMF,GAJ4B,UAAxBgB,EAAOR,EAAOzC,QAChByC,EAAOzC,KAAQyC,EAAOzC,KAA0BkD,KAAKC,IAGnDf,EAAS,CACX,MAAMjC,MAAEA,EAAOO,SAAAA,GAAa+B,EAC5BtC,IAAUsC,EAAOtC,OAAS,IAC1BO,IAAa+B,EAAO/B,UAAY,GAClC,CAcA,aAVI4B,WAAUc,UACZX,EAAOH,SAAWA,EAASe,KAAKC,IAC1B,GAAiB,WAAjBL,EAAOK,GAA2B,OAAA,EAChC,MAAErB,IAAAA,EAAKsB,MAAAA,GAAUvB,EAAYsB,EAAuBpB,IAAOC,EAAeQ,GAIzEV,OAHHsB,EAAQlB,IACDA,EAAAkB,GAEJtB,CAAAA,KAGJ,CAAEA,IAAKQ,EAAQc,MAAOlB,EAC/B"}