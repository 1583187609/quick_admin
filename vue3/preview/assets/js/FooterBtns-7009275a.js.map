{"version":3,"file":"FooterBtns-7009275a.js","sources":["../../../src/components/form/_components/FooterBtns.vue"],"sourcesContent":["<!-- 页面-简介 -->\r\n<template>\r\n  <div class=\"footer-btns f-c-c f-0 pt-h pb-h\">\r\n    <el-button type=\"primary\" v-debounce.immediate=\"handleSubmit\" :disabled=\"disabled || isLoading\" v-if=\"submitText\">\r\n      <template #icon>\r\n        <BaseIcon :class=\"{ rotate: isLoading }\" :name=\"isLoading ? 'Loading' : 'Promotion'\"></BaseIcon>\r\n      </template>\r\n      {{ submitText }}\r\n    </el-button>\r\n    <template v-for=\"(btn, ind) in newMoreBtns\" :key=\"ind\">\r\n      <BaseBtn @click=\"handleMoreBtns(btn)\" :name=\"btn\" :disabled=\"disabled\" v-if=\"btn.popconfirm\" />\r\n      <BaseBtn v-debounce.immediate=\"() => handleMoreBtns(btn)\" :name=\"btn\" :disabled=\"disabled\" v-else />\r\n    </template>\r\n    <el-button :icon=\"RefreshLeft\" @click=\"handleReset\" :disabled=\"disabled || isLoading\" v-if=\"resetText\">{{\r\n      resetText\r\n    }}</el-button>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { ref, inject, watch, computed } from \"vue\";\r\nimport { RefreshLeft } from \"@element-plus/icons-vue\";\r\nimport { BaseBtnType, BtnItem, getBtnObj } from \"@/components/BaseBtn\";\r\nimport { deleteAttrs, omitAttrs, printLog, splitPropsParams, showMessage } from \"@/components/_utils\";\r\nimport { CommonObj, FinallyNext, UniteFetchType } from \"@/vite-env\";\r\nimport { ClosePopupType } from \"@/App.vue\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"FooterBtns\" }); \n\r\nconst closePopup: any = inject(\"closePopup\");\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    loading?: boolean;\r\n    submitText?: string;\r\n    resetText?: string;\r\n    moreBtns?: BaseBtnType[]; //底部的额外更多按钮\r\n    formRef?: any;\r\n    isOmit?: boolean;\r\n    log?: boolean;\r\n    debug?: boolean;\r\n    params?: any;\r\n    fetch?: UniteFetchType; //请求接口，一般跟fetchSuccess，fetchFail一起配合使用\r\n    fetchSuccess?: FinallyNext;\r\n    fetchFail?: FinallyNext;\r\n    noSubmitProps?: string[]; //提交表单时，不要提交的prop属性\r\n    handleRequest?: (args: CommonObj) => CommonObj; //处理参数\r\n    disabled?: boolean; //是否禁用按钮\r\n  }>(),\r\n  {\r\n    isOmit: true,\r\n    submitText: \"提交\",\r\n    resetText: \"重置\",\r\n    moreBtns: () => [],\r\n  }\r\n);\r\nconst emits = defineEmits([\"moreBtns\", \"submit\"]);\r\nconst isLoading = ref(false);\r\nconst newMoreBtns = computed(() => props.moreBtns.map((btn: BaseBtnType) => getBtnObj(btn)));\r\nwatch(\r\n  () => props.loading,\r\n  newVal => {\r\n    isLoading.value = newVal;\r\n  }\r\n);\r\n//处理校验逻辑\r\nfunction handleValidate() {\r\n  const { log, debug, isOmit, noSubmitProps } = props;\r\n  return new Promise((resolve, reject) => {\r\n    let { params } = props;\r\n    const { formRef, handleRequest } = props;\r\n    if (!formRef) return;\r\n    formRef.validate((valid: any, fieldsObj: CommonObj) => {\r\n      if (valid) {\r\n        params = splitPropsParams(params);\r\n        if (handleRequest) {\r\n          params = handleRequest(params);\r\n        }\r\n        isOmit && (params = omitAttrs(params));\r\n        params = deleteAttrs(params, noSubmitProps);\r\n        if (log || debug) {\r\n          printLog(params, \"req\");\r\n          if (debug) return;\r\n        }\r\n        resolve(params);\r\n      } else {\r\n        const target = Object.values(fieldsObj)[0][0];\r\n        showMessage(target.message, \"error\");\r\n        reject(target);\r\n      }\r\n    });\r\n  });\r\n}\r\n//请求成功之后的回调函数\r\nconst fetchSucCb: FinallyNext = (\r\n  hint = props.submitText + \"成功！\",\r\n  closeType?: ClosePopupType,\r\n  cb?: () => void,\r\n  isRefreshList = true\r\n) => {\r\n  showMessage(hint);\r\n  closePopup(closeType);\r\n  cb?.();\r\n};\r\n//提交表单\r\nfunction handleSubmit() {\r\n  handleValidate()\r\n    .then((params: any) => {\r\n      const { log, fetch, fetchSuccess = fetchSucCb, fetchFail, submitText } = props;\r\n      if (fetch) {\r\n        isLoading.value = true;\r\n        fetch(params)\r\n          .then((res: any) => {\r\n            log && printLog(res, \"res\");\r\n            fetchSuccess(submitText + \"成功！\");\r\n          })\r\n          .catch((err: any) => {\r\n            fetchFail?.(err);\r\n          })\r\n          .finally(() => {\r\n            isLoading.value = false;\r\n          });\r\n      } else {\r\n        emits(\"submit\", params);\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n//重置表单\r\nfunction handleReset() {\r\n  const { formRef } = props;\r\n  if (!formRef) return;\r\n  formRef.resetFields();\r\n}\r\n//点击更多按钮时\r\nfunction handleMoreBtns(btn: BtnItem) {\r\n  const { name, validate, to } = btn;\r\n  if (to !== undefined) return;\r\n  if (validate) {\r\n    handleValidate()\r\n      .then(params => {\r\n        emits(\"moreBtns\", name, params, fetchSucCb);\r\n      })\r\n      .catch(() => {});\r\n  } else {\r\n    emits(\"moreBtns\", name, props.params, fetchSucCb);\r\n  }\r\n}\r\ndefineExpose({\r\n  formValidate: handleValidate,\r\n  submit: handleSubmit,\r\n});\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.footer-btns {\r\n  width: 100%;\r\n}\r\n</style>\r\n"],"names":["closePopup","inject","props","__props","emits","__emit","isLoading","ref","newMoreBtns","computed","moreBtns","map","btn","getBtnObj","handleValidate","log","debug","isOmit","noSubmitProps","Promise","resolve","reject","params","formRef","handleRequest","validate","valid","fieldsObj","splitPropsParams","omitAttrs","deleteAttrs","printLog","target","Object","values","showMessage","message","watch","loading","newVal","value","fetchSucCb","hint","submitText","closeType","cb","isRefreshList","handleSubmit","then","fetch","fetchSuccess","fetchFail","res","catch","err","finally","handleReset","resetFields","handleMoreBtns","name","to","__expose","formValidate","submit"],"mappings":"m9DA4BM,MAAAA,EAAkBC,EAAO,cACzBC,EAAQC,EAyBRC,EAAQC,EACRC,EAAYC,GAAI,GAChBC,EAAcC,GAAS,IAAMP,EAAMQ,SAASC,KAAKC,GAAqBC,EAAUD,OAQtF,SAASE,IACP,MAAMC,IAAEA,EAAAC,MAAKA,EAAOC,OAAAA,EAAAC,cAAQA,GAAkBhB,EAC9C,OAAO,IAAIiB,SAAQ,CAACC,EAASC,KACvB,IAAAC,OAAEA,GAAWpB,EACX,MAAAqB,QAAEA,EAASC,cAAAA,GAAkBtB,EAC9BqB,GACGA,EAAAE,UAAS,CAACC,EAAYC,KAC5B,GAAID,EAAO,CAOT,GANAJ,EAASM,EAAiBN,GACtBE,IACFF,EAASE,EAAcF,IAEdL,IAAAK,EAASO,EAAUP,IACrBA,EAAAQ,EAAYR,EAAQJ,IACzBH,GAAOC,KACTe,EAAST,EAAQ,OACbN,GAAO,OAEbI,EAAQE,EAAM,KACT,CACL,MAAMU,EAASC,OAAOC,OAAOP,GAAW,GAAG,GAC/BQ,EAAAH,EAAOI,QAAS,SAC5Bf,EAAOW,EACT,IACD,GAEL,CAjCAK,GACE,IAAMnC,EAAMoC,UACFC,IACRjC,EAAUkC,MAAQD,CAAA,IAgChB,MAAAE,EAA0B,CAC9BC,EAAOxC,EAAMyC,WAAa,MAC1BC,EACAC,EACAC,GAAgB,KAEhBX,EAAYO,GACZ1C,EAAW4C,GACN,MAAAC,GAAAA,GAAA,EAGP,SAASE,IACQjC,IACZkC,MAAM1B,IACL,MAAMP,IAAEA,EAAKkC,MAAAA,EAAAC,aAAOA,EAAeT,EAAYU,UAAAA,EAAAR,WAAWA,GAAezC,EACrE+C,GACF3C,EAAUkC,OAAQ,EAClBS,EAAM3B,GACH0B,MAAMI,IACErC,GAAAgB,EAASqB,EAAK,OACrBF,EAAaP,EAAa,MAAK,IAEhCU,OAAOC,IACM,MAAAH,GAAAA,EAAAG,EAAA,IAEbC,SAAQ,KACPjD,EAAUkC,OAAQ,CAAA,KAGtBpC,EAAM,SAAUkB,EAClB,IAED+B,OAAM,QACX,CAEA,SAASG,IACD,MAAAjC,QAAEA,GAAYrB,EACfqB,GACLA,EAAQkC,aACV,CAEA,SAASC,EAAe9C,GACtB,MAAM+C,KAAEA,EAAAlC,SAAMA,EAAUmC,GAAAA,GAAOhD,OACpB,IAAPgD,IACAnC,EACaX,IACZkC,MAAe1B,IACRlB,EAAA,WAAYuD,EAAMrC,EAAQmB,EAAU,IAE3CY,OAAM,SAETjD,EAAM,WAAYuD,EAAMzD,EAAMoB,OAAQmB,GAE1C,QACaoB,EAAA,CACXC,aAAchD,EACdiD,OAAQhB"}