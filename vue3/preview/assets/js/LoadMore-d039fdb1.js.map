{"version":3,"file":"LoadMore-d039fdb1.js","sources":["../../../src/components/LoadMore.vue"],"sourcesContent":["<!-- 页面-简介 -->\r\n<template>\r\n  <el-scrollbar @mousewheel.passive=\"handleMousewheel\" class=\"load-more\" ref=\"boxRef\">\r\n    <div class=\"no-more-tips top f-c-c\" :class=\"{ show: !topHasMore && isReachTop }\">\r\n      {{ noMoreTips }}\r\n    </div>\r\n    <div class=\"space top\" :style=\"`height: ${toCssVal(paddingTop)};`\"></div>\r\n    <div class=\"f-c-c load-tips\" v-if=\"loading && !isToBottom\">\r\n      <BaseIcon class=\"rotate\" name=\"Loading\" />\r\n      <span class=\"text\">{{ loadTips }}</span>\r\n    </div>\r\n    <slot><BaseEmpty :tips=\"emptyTips\" /></slot>\r\n    <div :style=\"`height: ${toCssVal(paddingBottom)};`\"></div>\r\n    <div class=\"f-c-c load-tips\" v-if=\"loading && isToBottom\">\r\n      <BaseIcon class=\"rotate\" name=\"Loading\" />\r\n      <span class=\"text\">{{ loadTips }}</span>\r\n    </div>\r\n  </el-scrollbar>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, watch, computed, onMounted } from \"vue\";\r\nimport { CommonObj, FinallyNext, StrNum, SetTimeout } from \"@/vite-env\";\r\nimport { toCssVal } from \"@/components/_utils\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"LoadMore\" }); \n\r\nlet timeout: SetTimeout = null;\r\nconst noMoreTipsDuration = 2000;\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    topDistance?: number; //距离顶部多少距离时触发触顶事件\r\n    bottomDistance?: number; //距离底部多少距离时触发触底事件\r\n    loading?: boolean; //是否在加载中\r\n    paddingTop?: StrNum; //距离盒子顶部的padding，只有出现滚动条时，设置此值才有意义\r\n    paddingBottom?: StrNum; //距离盒子底部的padding，只有出现滚动条时，设置此值才有意义\r\n    debounceDelay?: number; //防抖延迟时间，单位毫秒\r\n    noMoreTips?: string; //没有更多文字提示\r\n    topHasMore?: boolean; //顶部是否还有更多\r\n    loadTips?: string; //加载文字提示\r\n    emptyTips?: string; //空状态提示文字\r\n  }>(),\r\n  {\r\n    topDistance: 150,\r\n    bottomDistance: 150,\r\n    paddingTop: 0,\r\n    paddingBottom: 0,\r\n    debounceDelay: 300,\r\n    topHasMore: true,\r\n    noMoreTips: \"没有更多啦~\",\r\n    loadTips: \"玩命加载中…\",\r\n    emptyTips: \"换个姿势搜搜看~\",\r\n  }\r\n);\r\nconst emits = defineEmits([\"reachTop\", \"reachBottom\"]);\r\nconst isToBottom = ref(false);\r\nconst hasScroll = ref(false); //是否出现了滚动条\r\nconst boxRef = ref<any>(null);\r\nconst isReachTop = ref(false);\r\nconst isReachBottom = ref(false);\r\nonMounted(() => {\r\n  if (!boxRef?.value?.wrapRef) return;\r\n  const { scrollHeight, clientHeight } = boxRef.value.wrapRef;\r\n  hasScroll.value = scrollHeight > clientHeight;\r\n});\r\nfunction handleMousewheel(e: any) {\r\n  if (!boxRef?.value?.wrapRef) return;\r\n  const { scrollTop, scrollHeight, clientHeight } = boxRef.value.wrapRef;\r\n  if (scrollHeight <= clientHeight) return; //未出现滚动条\r\n  const { deltaY } = e;\r\n  isToBottom.value = deltaY > 0; // 是否是向下滚动\r\n  const { topDistance, bottomDistance, debounceDelay } = props;\r\n  if (isToBottom.value) {\r\n    //加1是因为el-scrollbar 有 1px 像素误差，不然触发不了触底事件\r\n    if (scrollTop + clientHeight + bottomDistance + 1 >= scrollHeight) {\r\n      if (timeout) clearTimeout(timeout);\r\n      const canExe = !timeout;\r\n      timeout = setTimeout(function () {\r\n        timeout = null;\r\n      }, debounceDelay);\r\n      if (canExe) {\r\n        console.log(\"触底------\");\r\n        emits(\"reachBottom\", e);\r\n        isReachBottom.value = true;\r\n        setTimeout(() => {\r\n          isReachBottom.value = false;\r\n        }, noMoreTipsDuration);\r\n      }\r\n    }\r\n  } else {\r\n    if (scrollTop <= topDistance) {\r\n      if (timeout) clearTimeout(timeout);\r\n      const canExe = !timeout;\r\n      timeout = setTimeout(function () {\r\n        timeout = null;\r\n      }, debounceDelay);\r\n      if (canExe) {\r\n        // console.log(\"触顶------\");\r\n        emits(\"reachTop\", e);\r\n        isReachTop.value = true;\r\n        setTimeout(() => {\r\n          isReachTop.value = false;\r\n        }, noMoreTipsDuration);\r\n      }\r\n    }\r\n  }\r\n}\r\ndefineExpose({\r\n  //滚动到底部\r\n  scrollToBottom() {\r\n    const { scrollTop, scrollHeight, clientHeight } = boxRef.value.wrapRef;\r\n    if (scrollHeight <= clientHeight) return; //未出现滚动条\r\n    boxRef.value.wrapRef.scrollTo(0, scrollHeight);\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.load-more {\r\n  position: relative;\r\n  // scroll-behavior: smooth;\r\n}\r\n.space {\r\n  // &.top {\r\n  //   margin-top: 40px;\r\n  // }\r\n}\r\n.no-more-tips {\r\n  position: absolute;\r\n  width: 100%;\r\n  left: 0;\r\n  top: -40px;\r\n  height: 40px;\r\n  z-index: 10;\r\n  color: $color-warning;\r\n  background: #fdf6ec;\r\n  transition: top 0.65s;\r\n  &.show {\r\n    top: 0;\r\n  }\r\n}\r\n.load-tips {\r\n  padding: $gap 0;\r\n  text-align: center;\r\n  .text {\r\n    margin-left: $gap-half;\r\n    color: $color-text-light;\r\n  }\r\n}\r\n</style>\r\n"],"names":["timeout","props","__props","emits","__emit","isToBottom","ref","hasScroll","boxRef","isReachTop","isReachBottom","handleMousewheel","e","_a","value","wrapRef","scrollTop","scrollHeight","clientHeight","deltaY","topDistance","bottomDistance","debounceDelay","clearTimeout","canExe","setTimeout","onMounted","__expose","scrollToBottom","scrollTo"],"mappings":"s6DA0BA,IAAIA,EAAsB,KAE1B,MAAMC,EAAQC,EAyBRC,EAAQC,EACRC,EAAaC,GAAI,GACjBC,EAAYD,GAAI,GAChBE,EAASF,EAAS,MAClBG,EAAaH,GAAI,GACjBI,EAAgBJ,GAAI,GAM1B,SAASK,EAAiBC,SACpB,KAAC,OAAAC,EAAQ,MAAAL,OAAA,EAAAA,EAAAM,YAAO,EAAAD,EAAAE,SAAS,OAC7B,MAAMC,UAAEA,EAAWC,aAAAA,EAAAC,aAAcA,GAAiBV,EAAOM,MAAMC,QAC/D,GAAIE,GAAgBC,EAAc,OAC5B,MAAAC,OAAEA,GAAWP,EACnBP,EAAWS,MAAQK,EAAS,EAC5B,MAAMC,YAAEA,EAAAC,eAAaA,EAAgBC,cAAAA,GAAkBrB,EACvD,GAAII,EAAWS,OAEb,GAAIE,EAAYE,EAAeG,EAAiB,GAAKJ,EAAc,CAC7DjB,GAASuB,aAAavB,GAC1B,MAAMwB,GAAUxB,EAChBA,EAAUyB,YAAW,WACTzB,EAAA,OACTsB,GACCE,IAEFrB,EAAM,cAAeS,GACrBF,EAAcI,OAAQ,EACtBW,YAAW,KACTf,EAAcI,OAAQ,CAAA,GAzDL,KA4DvB,OAEA,GAAIE,GAAaI,EAAa,CACxBpB,GAASuB,aAAavB,GAC1B,MAAMwB,GAAUxB,EAChBA,EAAUyB,YAAW,WACTzB,EAAA,OACTsB,GACCE,IAEFrB,EAAM,WAAYS,GAClBH,EAAWK,OAAQ,EACnBW,YAAW,KACThB,EAAWK,OAAQ,CAAA,GAzEF,KA4EvB,CAEJ,QA9CAY,GAAU,WACJ,KAAC,OAAAb,EAAQ,MAAAL,OAAA,EAAAA,EAAAM,YAAO,EAAAD,EAAAE,SAAS,OAC7B,MAAME,aAAEA,EAAAC,aAAcA,GAAiBV,EAAOM,MAAMC,QACpDR,EAAUO,MAAQG,EAAeC,CAAA,IA4CtBS,EAAA,CAEX,cAAAC,GACE,MAAMZ,UAAEA,EAAWC,aAAAA,EAAAC,aAAcA,GAAiBV,EAAOM,MAAMC,QAC3DE,GAAgBC,GACpBV,EAAOM,MAAMC,QAAQc,SAAS,EAAGZ,EACnC"}