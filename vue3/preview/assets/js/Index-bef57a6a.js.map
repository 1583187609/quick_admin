{"version":3,"file":"Index-bef57a6a.js","sources":["../../../src/components/CardCrud/Index.vue"],"sourcesContent":["<template>\r\n  <BaseCrud class=\"card-crud\" @rows=\"getRows\" ref=\"crudRef\" selectAll>\r\n    <template #default=\"{ loading, params, rows }\">\r\n      <div class=\"list-box f-fs-fs-w f-1\" v-loading=\"loading\">\r\n        <template v-for=\"(row, $index) in rows\" :key=\"$index\">\r\n          <template v-if=\"['avatar-audit', 'avatar-patrol'].includes(type)\">\r\n            <AvatarItem\r\n              class=\"item\"\r\n              :row=\"getAvatarRowData({ ...row, $index })\"\r\n              :withMask=\"type === 'avatar-audit' ? [2, ''].includes(row.status) : false\"\r\n              :status=\"row[statusKey]\"\r\n              :groupBtns=\"getGroupBtnsOfRow(row, $index)\"\r\n              @groupBtn=\"(btn:BtnItem)=>onGroupBtn(btn,{ ...row, $index },rows,params)\"\r\n              :isPatrol=\"type === 'avatar-patrol'\"\r\n            />\r\n          </template>\r\n          <AboutItem\r\n            class=\"item\"\r\n            :row=\"{ ...row, $index }\"\r\n            :status=\"row[statusKey]\"\r\n            :groupBtns=\"getGroupBtnsOfRow(row, $index)\"\r\n            @groupBtn=\"(btn:BtnItem)=>onGroupBtn(btn,{ ...row, $index },rows,params)\"\r\n            :bottomBar=\"row[statusKey] === 1 ? row.reason || '~原因为空~' : ''\"\r\n            v-else-if=\"type === 'about'\"\r\n          />\r\n          <FaceItem\r\n            class=\"item\"\r\n            :row=\"{ ...row, $index }\"\r\n            :status=\"row[statusKey]\"\r\n            :groupBtns=\"getGroupBtnsOfRow(row, $index)\"\r\n            @groupBtn=\"(btn:BtnItem)=>onGroupBtn(btn,{ ...row, $index },rows,params)\"\r\n            :bottomBar=\"row[statusKey] === 1 ? row.rejectReason || '~原因为空~' : ''\"\r\n            v-else-if=\"type === 'face'\"\r\n          />\r\n          <PhotoItem\r\n            class=\"item\"\r\n            :row=\"{ ...row, $index }\"\r\n            :status=\"row.status\"\r\n            :groupBtns=\"getGroupBtnsOfRow(row, $index)\"\r\n            @groupBtn=\"(btn:BtnItem)=>onGroupBtn(btn,{ ...row, $index },rows,params)\"\r\n            v-else-if=\"type === 'photo'\"\r\n          />\r\n        </template>\r\n        <BaseEmpty v-if=\"!loading && !rows.length\" />\r\n      </div>\r\n    </template>\r\n  </BaseCrud>\r\n</template>\r\n<script lang=\"ts\" name=\"CardCrud\" setup>\r\nimport { ref, reactive, watch, computed, useAttrs, inject } from \"vue\";\r\nimport { BaseBtnType, getBtnObj, BtnItem } from \"@/components/BaseBtn\";\r\nimport AvatarItem from \"./_components/AvatarItem.vue\";\r\nimport AboutItem from \"./_components/AboutItem.vue\";\r\nimport FaceItem from \"./_components/FaceItem.vue\";\r\nimport PhotoItem from \"./_components/PhotoItem.vue\";\r\nimport { getAvatarRowData } from \"./_utils\";\r\nimport { typeOf, showMessage } from \"@/components/_utils\";\r\nimport { FilterByAuthFn, getTempGroupBtnsOfRow } from \"@/components/BaseCrud\";\r\nimport { CommonObj } from \"@/vite-env\";\r\nimport { ClosePopupType } from \"@/App.vue\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"CardCrud\" }); \n\r\nexport type AboutCode = 0 | 1; //| \"aboutMe\" | \"aboutYou\";\r\nexport type ItemType = \"avatar-audit\" | \"avatar-patrol\" | \"about\" | \"photo\" | \"face\";\r\nexport type AuditStatus = 0 | 1 | 2; // 0通过 1驳回 2未审核\r\nconst closePopup: any = inject(\"closePopup\");\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    type?: ItemType; //插入的item组件类型\r\n    filterByAuth?: FilterByAuthFn;\r\n    groupBtns?: any;\r\n    // extraBtns?: BaseBtnType[]; //额外的按钮，在表单下方，表格上方\r\n  }>(),\r\n  {\r\n    type: \"avatar-audit\",\r\n  }\r\n);\r\nconst emits = defineEmits([\"groupBtn\"]);\r\nconst statusKey = \"status\";\r\nconst crudRef = ref<any>(null);\r\nconst newRows = ref<CommonObj[]>([]);\r\nfunction getRows(rows: CommonObj[], args: CommonObj) {\r\n  newRows.value = rows;\r\n}\r\n//获取每一行的分组按钮\r\nfunction getGroupBtnsOfRow(row: CommonObj, $rowInd: number) {\r\n  const { groupBtns } = props;\r\n  const tempBtns = getTempGroupBtnsOfRow(row, $rowInd, groupBtns);\r\n  return filterBtnsByAuth(tempBtns);\r\n}\r\n//点击分组按钮\r\nfunction onGroupBtn(btn: BtnItem, row: CommonObj, rows: CommonObj[], params?: CommonObj) {\r\n  const { name, text } = btn;\r\n  emits(\r\n    \"groupBtn\",\r\n    name,\r\n    row,\r\n    (hint = `${text || \"操作\"}成功！`, closeType?: ClosePopupType, cb?: () => void) => {\r\n      showMessage(hint);\r\n      closePopup(closeType);\r\n      const map: CommonObj = {\r\n        pass: 0,\r\n        reject: 1,\r\n      };\r\n      crudRef.value.refreshList(cb);\r\n    },\r\n    params\r\n  );\r\n}\r\n//根据权限对按钮进行过滤\r\nfunction filterBtnsByAuth(btns: BtnItem[] = []) {\r\n  const { filterByAuth } = props;\r\n  if (!filterByAuth) return btns;\r\n  return btns.filter(({ auth }) => {\r\n    return auth?.length ? filterByAuth(auth) : true;\r\n  });\r\n}\r\ndefineExpose(crudRef.value);\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.card-crud {\r\n  overflow: auto;\r\n  .list-box {\r\n    align-content: flex-start;\r\n    position: relative;\r\n    overflow: auto;\r\n    .item {\r\n      margin-right: $gap-half;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["statusKey","closePopup","inject","props","__props","emits","__emit","crudRef","ref","newRows","getRows","rows","args","value","getGroupBtnsOfRow","row","$rowInd","groupBtns","btns","filterByAuth","filter","auth","length","filterBtnsByAuth","getTempGroupBtnsOfRow","onGroupBtn","btn","params","name","text","hint","closeType","cb","showMessage","refreshList","__expose"],"mappings":"0zDA+EMA,EAAY,gKAbZ,MAAAC,EAAkBC,EAAO,cACzBC,EAAQC,EAWRC,EAAQC,EAERC,EAAUC,EAAS,MACnBC,EAAUD,EAAiB,IACxB,SAAAE,EAAQC,EAAmBC,GAClCH,EAAQI,MAAQF,CAClB,CAES,SAAAG,EAAkBC,EAAgBC,GACnC,MAAAC,UAAEA,GAAcd,EAEtB,OAsBO,SAAiBe,EAAkB,IACpC,MAAAC,aAAEA,GAAiBhB,EACzB,OAAKgB,EACED,EAAKE,QAAO,EAAGC,YACP,MAANA,OAAM,EAAAA,EAAAC,SAASH,EAAaE,KAFXH,CAI5B,CA5BSK,CADUC,EAAsBT,EAAKC,EAASC,GAEvD,CAEA,SAASQ,EAAWC,EAAcX,EAAgBJ,EAAmBgB,GAC7D,MAAAC,KAAEA,EAAMC,KAAAA,GAASH,EACvBrB,EACE,WACAuB,EACAb,GACA,CAACe,EAAO,GAAGD,GAAQ,UAAWE,EAA4BC,KACxDC,EAAYH,GACZ7B,EAAW8B,GAKHxB,EAAAM,MAAMqB,YAAYF,EAAE,GAE9BL,EAEJ,QASAQ,EAAa5B,EAAQM"}