{"version":3,"file":"HandleUser-954d10e6.js","sources":["../../../src/views/_components/HandleUser.vue"],"sourcesContent":["<!-- 组件 - 处罚/处理/解封用户 -->\r\n<template>\r\n  <BaseForm\r\n    style=\"width: 550px\"\r\n    v-model=\"model\"\r\n    :fields=\"fields\"\r\n    :fetch=\"handleFetch\"\r\n    :fetchSuccess=\"refreshPage\"\r\n    :extraParams=\"{ relationTypeList: [0] }\"\r\n    :no-submit-props=\"type === 'unseal' ? ['forbidLevel', 'timeDay'] : []\"\r\n    @change=\"handleChange\"\r\n  >\r\n  </BaseForm>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, nextTick, computed } from \"vue\";\r\nimport { FormField } from \"@/components/BaseFormItem\";\r\nimport { PostMockCommon } from \"@/api-mock\";\r\nimport { CommonObj, FinallyNext, StrNum } from \"@/vite-env\";\r\nexport type FormType = \"unseal\" | \"add\" | \"handle\";\r\nexport type SceneType = \"warning\" | \"login\" | \"all-interaction\";\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    type: FormType;\r\n    data: {\r\n      id?: StrNum; //举报id\r\n      userId?: StrNum; //用户id\r\n      [key: string]: any;\r\n    };\r\n    refreshPage?: FinallyNext;\r\n  }>(),\r\n  {}\r\n);\r\nconst model = reactive<CommonObj>(\r\n  Object.assign(\r\n    {\r\n      // userId: props?.data?.userId,\r\n      scene: \"warning\",\r\n      timeDay: 1,\r\n      forbidLevel: 1,\r\n    },\r\n    props.data\r\n  )\r\n);\r\nconst fields = computed<FormField[]>(() => {\r\n  const { scene } = model;\r\n  const { type } = props;\r\n  return [\r\n    {\r\n      prop: \"userId\",\r\n      label: \"用户ID\",\r\n      attrs: {\r\n        disabled: type !== \"add\",\r\n      },\r\n    },\r\n    ...(type === \"unseal\"\r\n      ? []\r\n      : [\r\n          {\r\n            prop: \"scene\",\r\n            label: \"处罚类型\",\r\n            type: \"radio-group\",\r\n            required: true,\r\n            options: [],\r\n            attrs: {},\r\n          },\r\n          scene === \"all-interaction\" && {\r\n            prop: \"timeDay\",\r\n            label: \"时间\",\r\n            required: true,\r\n            type: \"input-number\",\r\n            attrs: {\r\n              min: 1,\r\n              style: { width: \"180px\" },\r\n            },\r\n            extra: {\r\n              after: \"天\",\r\n            },\r\n          },\r\n          scene !== \"login\" && {\r\n            prop: \"fromMsg\",\r\n            label: \"回复用户\",\r\n            required: true,\r\n            attrs: {\r\n              type: \"textarea\",\r\n              maxlength: 100,\r\n              rows: 3,\r\n            },\r\n          },\r\n          scene === \"login\" && {\r\n            prop: \"forbidLevel\",\r\n            label: \"违规级别\",\r\n            type: \"radio-group\",\r\n            required: true,\r\n            options: [],\r\n            tips: \"数值越小处罚程度越严重\",\r\n          },\r\n        ]),\r\n    {\r\n      prop: \"remark\",\r\n      label: \"备注\",\r\n      required: true,\r\n      attrs: {\r\n        type: \"textarea\",\r\n        maxlength: 100,\r\n        rows: 3,\r\n      },\r\n    },\r\n  ];\r\n});\r\n//处理表单请求\r\nfunction handleFetch(params: CommonObj) {\r\n  const { type, data } = props;\r\n  params.relationDataList = {\r\n    userId: type === \"add\" ? params.userId : data.userId,\r\n  };\r\n  if (type === \"unseal\") {\r\n    //status: 0=维持现有封禁;1=解除封禁\r\n    params.status = 1;\r\n    params.id = data.id;\r\n    return PostMockCommon(params);\r\n  } else {\r\n    delete params.userId;\r\n    return PostMockCommon(params);\r\n  }\r\n}\r\n//处理表单值变化时\r\nfunction handleChange(prop: string, val: SceneType) {\r\n  if (prop === \"scene\") {\r\n    model.fromMsg = getReplyMsg(val);\r\n  } else if (prop === \"timeDay\") {\r\n    if (model.scene === \"all-interaction\") {\r\n      nextTick(() => {\r\n        model.fromMsg = getReplyMsg(\"all-interaction\");\r\n      });\r\n    }\r\n  }\r\n}\r\n//获取回复消息\r\nfunction getReplyMsg(type: SceneType) {\r\n  const days = model.timeDay;\r\n  const map: CommonObj = {\r\n    warning:\r\n      \"经用户举报，并经平台核实，您因违反平台行为规范，存在违规行为，现对您进行消息警告通知！请严格遵守《脱单计划行为规范》。\",\r\n    login: \"\",\r\n    \"all-interaction\": `经用户举报，并经平台核实，您因违反平台行为规范，存在违规行为，现被处罚禁止互动${days}天！请严格遵守《脱单计划行为规范》，再次出现违规行为，将被永久封禁！`,\r\n  };\r\n  return map[type] ?? \"\";\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["props","__props","model","reactive","Object","assign","scene","timeDay","forbidLevel","data","fields","computed","type","prop","label","attrs","disabled","required","options","min","style","width","extra","after","maxlength","rows","tips","handleFetch","params","relationDataList","userId","status","id","PostMockCommon","handleChange","val","fromMsg","getReplyMsg","nextTick","warning","login"],"mappings":"w9CAqBA,MAAMA,EAAQC,EAYRC,EAAQC,EACZC,OAAOC,OACL,CAEEC,MAAO,UACPC,QAAS,EACTC,YAAa,GAEfR,EAAMS,OAGJC,EAASC,GAAsB,KAC7B,MAAAL,MAAEA,GAAUJ,GACZU,KAAEA,GAASZ,EACV,MAAA,CACL,CACEa,KAAM,SACNC,MAAO,OACPC,MAAO,CACLC,SAAmB,QAATJ,OAGD,WAATA,EACA,GACA,CACE,CACEC,KAAM,QACNC,MAAO,OACPF,KAAM,cACNK,UAAU,EACVC,QAAS,GACTH,MAAO,CAAC,GAEA,oBAAVT,GAA+B,CAC7BO,KAAM,UACNC,MAAO,KACPG,UAAU,EACVL,KAAM,eACNG,MAAO,CACLI,IAAK,EACLC,MAAO,CAAEC,MAAO,UAElBC,MAAO,CACLC,MAAO,MAGD,UAAVjB,GAAqB,CACnBO,KAAM,UACNC,MAAO,OACPG,UAAU,EACVF,MAAO,CACLH,KAAM,WACNY,UAAW,IACXC,KAAM,IAGA,UAAVnB,GAAqB,CACnBO,KAAM,cACNC,MAAO,OACPF,KAAM,cACNK,UAAU,EACVC,QAAS,GACTQ,KAAM,gBAGd,CACEb,KAAM,SACNC,MAAO,KACPG,UAAU,EACVF,MAAO,CACLH,KAAM,WACNY,UAAW,IACXC,KAAM,IAEV,IAIJ,SAASE,EAAYC,GACb,MAAAhB,KAAEA,EAAMH,KAAAA,GAAST,EAIvB,OAHA4B,EAAOC,iBAAmB,CACxBC,OAAiB,QAATlB,EAAiBgB,EAAOE,OAASrB,EAAKqB,QAEnC,WAATlB,GAEFgB,EAAOG,OAAS,EAChBH,EAAOI,GAAKvB,EAAKuB,GACVC,EAAeL,YAEfA,EAAOE,OACPG,EAAeL,GAE1B,CAES,SAAAM,EAAarB,EAAcsB,GACrB,UAATtB,EACIX,EAAAkC,QAAUC,EAAYF,GACV,YAATtB,GACW,oBAAhBX,EAAMI,OACRgC,GAAS,KACDpC,EAAAkC,QAAUC,EAAY,kBAAiB,GAIrD,CAEA,SAASA,EAAYzB,GAQZ,MANgB,CACrB2B,QACE,8DACFC,MAAO,GACP,kBAAmB,0CALRtC,EAAMK,6CAORK,IAAS,EACtB"}