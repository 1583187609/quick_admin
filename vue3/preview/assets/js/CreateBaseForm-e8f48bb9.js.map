{"version":3,"file":"CreateBaseForm-e8f48bb9.js","sources":["../../../src/views/test/test-9/CreateBaseForm.vue"],"sourcesContent":["<!-- 组件 - 创建基础表单 -->\r\n<template>\r\n  <div class=\"f-sb-fs\" style=\"height: 200px\">\r\n    <SectionForm class=\"create-base-form f-3\" v-model=\"model\" :sections=\"sections\" debug> </SectionForm>\r\n    <!-- <BaseSection class=\"create-base-form f-3\" title=\"第一部分\">\r\n      <el-form>\r\n        <template v-for=\"(field, ind) in getFields()\" :key=\"ind\">\r\n          <BaseFormItem :field=\"field\" v-model=\"fieldsArr[ind]\" />\r\n        </template>\r\n      </el-form>\r\n    </BaseSection> -->\r\n    <div class=\"ml-t f-1 f-fs-s-c\">\r\n      <h1 class=\"title f-0\">预览</h1>\r\n      <BaseForm class=\"f-1 ml-o\" :fields=\"fields\" disabled></BaseForm>\r\n      <h1 class=\"title mt-t f-0\">JSON</h1>\r\n      <!-- v-model=\"fieldsStr\" -->\r\n      <el-input\r\n        class=\"f-0\"\r\n        type=\"textarea\"\r\n        @change=\"handleChange\"\r\n        :modelValue=\"fieldsStr\"\r\n        :rows=\"4\"\r\n        placeholder=\"表单字段项，JSON\"\r\n        readonly\r\n        clearable\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, watch, computed, inject, h } from \"vue\";\r\nimport { FormField, FormFieldAttrs } from \"@/components/BaseFormItem\";\r\nimport { CommonObj, FinallyNext, StrNum, OptionItem } from \"@/vite-env\";\r\nimport { exampleMap } from \"./_config\";\r\nimport SectionForm from \"@/components/form/SectionForm.vue\";\r\nimport { SectionFormItem, SectionFormItemAttrs } from \"@/components/form\";\r\nimport Config from \"./_components/Config.vue\";\r\nimport { omitAttrs, typeOf } from \"@/utils\";\nimport { defineOptions } from 'vue'; \ndefineOptions({ name: \"TestTest9CreateBaseForm\" }); \n\r\n\r\nconst openPopup = inject<any>(\"openPopup\");\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    exampleProp?: CommonObj;\r\n  }>(),\r\n  {\r\n    exampleProp: () => ({}),\r\n  }\r\n);\r\nconst widgetTypeOpts: OptionItem[] = [\r\n  { label: \"输入框\", value: \"input\" },\r\n  { label: \"数字输入框\", value: \"input-number\" },\r\n  { label: \"选择框\", value: \"select\" },\r\n  { label: \"级联\", value: \"cascader\" },\r\n  { label: \"多选框\", value: \"checkbox\" },\r\n  { label: \"自定义\", value: \"custom\" },\r\n];\r\nconst validOpts: OptionItem[] = [\r\n  { label: \"电话号码\", value: \"phone\" },\r\n  { label: \"身份证号\", value: \"identity\" },\r\n  { label: \"密码\", value: \"password\" },\r\n  { label: \"邮箱\", value: \"identity\" },\r\n  { label: \"年龄\", value: \"age\" },\r\n];\r\nconst model = reactive<CommonObj>(\r\n  Object.assign(\r\n    {}\r\n    // { prop: \"xm\", label: \"姓名\" }\r\n    // { type: \"input\", required: false, prop: \"xm\", label: \"姓名\" }\r\n  )\r\n);\r\nconst yesNoOpts: OptionItem[] = [\r\n  { label: \"是\", value: true },\r\n  { label: \"否\", value: false },\r\n];\r\nconst fields = ref<FormFieldAttrs[]>([]);\r\nconst fieldsStr = ref<string>(\"\");\r\nconst names = [\r\n  { prop: \"xm\", label: \"姓名\" },\r\n  { prop: \"xb\", label: \"性别\" },\r\n  { prop: \"nl\", label: \"年龄\" },\r\n  { prop: \"dh\", label: \"电话\" },\r\n];\r\nconst sections = computed<SectionFormItemAttrs[]>(() => {\r\n  const fields: FormField[] = getFields();\r\n  return names.map((item, ind) => {\r\n    // const { prop, label } = model?.[ind] ?? {};\r\n    const { prop, label } = item;\r\n    setTimeout(() => {\r\n      model[prop].prop = prop;\r\n      model[prop].label = label;\r\n    });\r\n    return {\r\n      prop,\r\n      title: `${label || \"-\"}(${prop || \"-\"})`,\r\n      fields,\r\n    };\r\n  });\r\n});\r\nwatch(\r\n  model,\r\n  newVal => {\r\n    newVal = omitAttrs(newVal);\r\n    const values = Object.values(newVal) as FormFieldAttrs[];\r\n    if (!values.some((item: CommonObj) => JSON.stringify(item) === \"{}\")) {\r\n      fields.value = values;\r\n      fieldsStr.value = JSON.stringify(values);\r\n    }\r\n  },\r\n  { deep: true }\r\n);\r\nfunction getFields(isChildren = false): FormFieldAttrs[] {\r\n  const showOpts = [\"select\", \"cascader\", \"checkbox-group\"].includes(model.type);\r\n  return [\r\n    { prop: \"label\", label: \"标签名\", span: 6, required: false },\r\n    { prop: \"prop\", label: \"属性名\", span: 6, required: false },\r\n    {\r\n      prop: \"type\",\r\n      label: \"控件类型\",\r\n      type: \"select\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"表单控件类型\",\r\n      },\r\n      options: widgetTypeOpts,\r\n    },\r\n    {\r\n      prop: \"required\",\r\n      label: \"是否必填\",\r\n      type: \"select\",\r\n      span: 6,\r\n      options: yesNoOpts,\r\n    },\r\n    {\r\n      prop: \"defaultValue\",\r\n      label: \"默认值\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"默认值\",\r\n      },\r\n    },\r\n    {\r\n      prop: \"example\",\r\n      label: \"例如文案\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"placeholder中的文字，会直接拼在placeholder文字后面\",\r\n      },\r\n    },\r\n    {\r\n      prop: \"valid\",\r\n      label: \"校验类型\",\r\n      type: \"select\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"内置的几种常用校验类型，含表单校验规则、属性等\",\r\n      },\r\n      options: validOpts,\r\n    },\r\n    {\r\n      prop: \"span\",\r\n      label: \"列宽占位\",\r\n      type: \"input-number\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"每个表单项占位宽度，最小为1，最大,为24\",\r\n      },\r\n      attrs: {\r\n        style: \"width:100%;\",\r\n        min: 1,\r\n        max: 24,\r\n      },\r\n    },\r\n    {\r\n      prop: \"pureText\",\r\n      label: \"是否纯文本\",\r\n      type: \"select\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"展示时，将不会看到输入框等边框，而是以纯文本展示\",\r\n      },\r\n      options: yesNoOpts,\r\n    },\r\n    {\r\n      prop: \"labelWidth\",\r\n      label: \"标签宽度\",\r\n      extra: {\r\n        span: 6,\r\n        popover: \"手动指定标签宽度\",\r\n      },\r\n      example: exampleMap.labelWidth,\r\n    },\r\n    showOpts && {\r\n      prop: \"options\",\r\n      label: \"下拉项\",\r\n      attrs: {\r\n        type: \"textarea\",\r\n        readonly: true,\r\n        onClick: () => openConfigPopup(\"options\"),\r\n      },\r\n      example: exampleMap.options,\r\n    },\r\n    {\r\n      prop: \"attrs\",\r\n      label: \"属性集\",\r\n      attrs: {\r\n        type: \"textarea\",\r\n        readonly: true,\r\n        onClick: () => openConfigPopup(\"attrs\"),\r\n      },\r\n      extra: {\r\n        span: 12,\r\n        example: exampleMap.attrs,\r\n        popover: \"属性参见ElementPlus官方文档：https://element-plus.org/zh-CN/component/button.html\",\r\n      },\r\n    },\r\n    {\r\n      prop: \"rules\",\r\n      label: \"规则集\",\r\n      attrs: {\r\n        type: \"textarea\",\r\n        readonly: true,\r\n        onClick: () => openConfigPopup(\"rules\"),\r\n      },\r\n      extra: {\r\n        span: 12,\r\n        popover: \"属性参见ElementPlus官方文档：https://element-plus.org/zh-CN/component/form.html#form-attributes\",\r\n      },\r\n      example: exampleMap.rules,\r\n    },\r\n    {\r\n      prop: \"tips\",\r\n      label: \"提示文案\",\r\n      extra: {\r\n        span: 12,\r\n        popover: \"控价下方的提示性文字\",\r\n      },\r\n    },\r\n    {\r\n      prop: \"tips\",\r\n      label: \"疑问文案\",\r\n      extra: {\r\n        span: 12,\r\n        popover: \"鼠标放到标签文字右侧问号图标上时，出现的提示性文字\",\r\n      },\r\n    },\r\n    {\r\n      prop: \"before\",\r\n      label: \"前置元素\",\r\n      extra: {\r\n        span: 12,\r\n        popover: \"每个表单项前面的元素，可以是文本或自定义组件\",\r\n      },\r\n      attrs: {\r\n        type: \"textarea\",\r\n        readonly: true,\r\n        rows: 1,\r\n        onClick: () => openConfigPopup(\"before\"),\r\n      },\r\n    },\r\n    {\r\n      prop: \"after\",\r\n      label: \"后置元素\",\r\n      extra: {\r\n        span: 12,\r\n        popover: \"每个表单项后面的元素，可以是文本或自定义组件\",\r\n      },\r\n      attrs: {\r\n        type: \"textarea\",\r\n        readonly: true,\r\n        rows: 1,\r\n        onClick: () => openConfigPopup(\"after\"),\r\n      },\r\n    },\r\n    {\r\n      prop: \"children\",\r\n      label: \"子级元素\",\r\n      extra: {\r\n        popover: \"表单项后面的子元素\",\r\n      },\r\n      attrs: {\r\n        type: \"textarea\",\r\n        readonly: true,\r\n        onClick: () => openConfigPopup(\"children\"),\r\n      },\r\n    },\r\n  ].filter((it: FormField) => typeOf(it) === \"Object\") as FormFieldAttrs[];\r\n}\r\n//打开配置弹窗\r\nfunction openConfigPopup(type: string = \"\") {\r\n  const label = getFields().find(it => it.prop === type)?.label;\r\n  openPopup(`编辑${label || \"\"}(${type})`, h(Config, { type }));\r\n}\r\n// openConfigPopup(\"options\");\r\nfunction handleChange(val: string) {\r\n  //   if (!val) return;\r\n  //   try {\r\n  //     Object.assign(model, JSON.parse(val));\r\n  //   } catch (err) {\r\n  //     console.error(err);\r\n  //   }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.title {\r\n  font-size: 18px;\r\n}\r\n</style>\r\n"],"names":["openPopup","inject","widgetTypeOpts","label","value","validOpts","model","reactive","Object","assign","yesNoOpts","fields","ref","fieldsStr","names","prop","sections","computed","getFields","map","item","ind","setTimeout","title","isChildren","showOpts","includes","type","span","required","extra","popover","options","attrs","style","min","max","example","exampleMap","labelWidth","readonly","onClick","openConfigPopup","rules","rows","filter","it","typeOf","_a","find","h","Config","handleChange","val","watch","newVal","omitAttrs","values","some","JSON","stringify","deep"],"mappings":"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"}